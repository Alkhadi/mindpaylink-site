(() => {
  "use strict"; const $ = (s, e = document) => e.querySelector(s), $$ = (s, e = document) => e.querySelectorAll(s); function wireNav() { const nav = $("#mainNav"), btn = $("#navToggle"); if (btn) btn.addEventListener("click", () => { nav?.classList.toggle("open"), btn.setAttribute("aria-expanded", nav?.classList.contains("open") ? "true" : "false") }); const qs = location.search || ""; $$("[data-href]").forEach(a => { if (!a.getAttribute("href")) a.setAttribute("href", a.getAttribute("data-href") + qs) }); const brand = $("#brandLink"); brand && brand.setAttribute("href", "index.html" + qs); const groups = Array.from(nav?.querySelectorAll(".nav-group") || []); function closeAll(e) { groups.forEach(t => { if (t !== e) { t.classList.remove("open"); const n = t.querySelector(".nav-button"); n && n.setAttribute("aria-expanded", "false") } }) } groups.forEach(e => { const t = e.querySelector(".nav-button"), n = e.querySelector(".menu"); t && n && (t.addEventListener("click", () => { const o = !e.classList.contains("open"); closeAll(o ? e : null), e.classList.toggle("open", o), t.setAttribute("aria-expanded", o ? "true" : "false") }), t.addEventListener("keydown", o => { o.key === "ArrowDown" && (o.preventDefault(), e.classList.add("open"), t.setAttribute("aria-expanded", "true"), (n.querySelector("a,button") || t).focus()), o.key === "Escape" && (o.preventDefault(), e.classList.remove("open"), t.setAttribute("aria-expanded", "false"), t.focus()) }), n.addEventListener("keydown", o => { o.key === "Escape" && (o.preventDefault(), e.classList.remove("open"), t.setAttribute("aria-expanded", "false"), t.focus()) })) }), document.addEventListener("click", e => { const t = e.target.closest?.(".nav-group,.nav-toggle,.main-nav"); t || closeAll(null) }) } wireNav(); const P = new URLSearchParams(location.search); function pick(...e) { for (const t of e) { const n = P.get(t); if (n !== null && n !== "") return n } return "" } const fallbackProfile = { name: "Alkhadi Koroma", title: "Professional Title Â· Flutter Developer", phone: "07736806367", email: "info@mindpaylink.com", avatar: "assets/alkhadi.png", bg: "assets/amz.jpg", wellbeing: "mindpaylink.com", acc: "01235467", sort: "012345", iban: "GB0000000000", ref: "M SHARE", x: "", ig: "", yt: "", ln: "", site: "mindpaylink.com", addr: "London, UK" }, LOCAL_KEY = "mshare_default_profile_v2"; async function loadProfile() { try { const e = JSON.parse(localStorage.getItem(LOCAL_KEY) || "null"); if (e) return e; const t = await fetch("assets/default_profile.json").catch(() => null); if (t && t.ok) { const n = await t.json(); return localStorage.setItem(LOCAL_KEY, JSON.stringify(n)), n } } catch { } return localStorage.setItem(LOCAL_KEY, JSON.stringify(fallbackProfile)), fallbackProfile } function withOverrides(e) { const t = { name: pick("n", "name"), title: pick("title"), phone: pick("ph", "phone"), email: pick("em", "email"), site: pick("s", "site"), addr: pick("a", "addr"), avatar: pick("av", "avatar"), bg: pick("bg", "background"), wellbeing: pick("wb", "wellbeing"), acc: pick("ac", "acc"), sort: pick("sc", "sort"), iban: pick("ib", "iban"), ref: pick("r", "ref"), x: pick("x"), ig: pick("ig"), yt: pick("yt"), ln: pick("ln") }, n = { ...e }; for (const [o, i] of Object.entries(t)) i && (n[o] = i); return localStorage.setItem(LOCAL_KEY, JSON.stringify(n)), n } let data = fallbackProfile; loadProfile().then(e => { data = withOverrides(e) }); function buildQP(e) { const t = { n: e.name, title: e.title, ph: e.phone, em: e.email, s: e.site, a: e.addr, av: e.avatar, bg: e.bg, wb: e.wellbeing, ac: e.acc, sc: e.sort, ib: e.iban, r: e.ref }, n = []; for (const [o, i] of Object.entries(t)) i && String(i).trim() !== "" && n.push(o + "=" + encodeURIComponent(i)); return n.length ? "?" + n.join("&") : "" } const qp = buildQP(data); function makeShareText() { const e = [`${data.name} â€” ${data.title}`, `Phone: ${data.phone}`, `Email: ${data.email}`, `Site: ${data.site}`, `Wellbeing: ${data.wellbeing}`, `Address: ${(data.addr || "").replace(/\n/g, ", ")}`, `Buy me coffee: ${location.origin + location.pathname.replace(/[^/]*$/, "") + "coffee.html" + qp}`]; return e.join("\n") } function openShareSheet() { const e = $("#shareSheet"); if (!e) return; const t = $("#shareText"); t && (t.value = makeShareText()), e.classList.add("open") } function closeShare() { $("#shareSheet")?.classList.remove("open") } $("#shareOpen")?.addEventListener("click", openShareSheet); $("#shareClose")?.addEventListener("click", closeShare); $("#shareBackdrop")?.addEventListener("click", closeShare); $("#copyShare")?.addEventListener("click", async () => { try { await navigator.clipboard.writeText($("#shareText").value), toast("Copied.") } catch { toast("Copy failed") } }); $("#shareNative")?.addEventListener("click", async () => { const e = $("#shareText")?.value || makeShareText(); if (navigator.share) try { await navigator.share({ text: e }) } catch { } else try { await navigator.clipboard.writeText(e), toast("Copied for sharing") } catch { } }); function bankDetailsString() { return [`${data.name} â€” ${data.ref || "M SHARE"}`, `Acc: ${data.acc}`, `Sort: ${data.sort}`, `IBAN: ${data.iban}`].join("\n") } function openAppOrStore(e, t) { const n = e, o = setTimeout(() => { window.open("https://www.google.com/search?q=" + encodeURIComponent(t + " bank app"), "_blank", "noopener") }, 1200); location.href = n, setTimeout(() => clearTimeout(o), 2e3) } function localDateKey(e = new Date) { const t = e.getFullYear(), n = String(e.getMonth() + 1).padStart(2, "0"), o = String(e.getDate()).padStart(2, "0"); return `${t}-${n}-${o}` } function parseDateKey(e) { const [t, n, o] = e.split("-").map(Number); return new Date(t, n - 1, o) } function dayDiff(e, t) { const n = new Date(e.getFullYear(), e.getMonth(), e.getDate()), o = new Date(t.getFullYear(), t.getMonth(), t.getDate()); return Math.round((o - n) / 864e5) } const STATS_KEY = "mshare_wellbeing_stats_v2", MSStats = { load() { try { return JSON.parse(localStorage.getItem(STATS_KEY) || "{}") || {} } catch { return {} } }, save(e) { try { localStorage.setItem(STATS_KEY, JSON.stringify(e)) } catch { } }, addSession({ techId: e, seconds: t, breaths: n }) { const o = this.load(); o.totalMinutes = (o.totalMinutes || 0) + t / 60, o.totalBreaths = (o.totalBreaths || 0) + (n || 0), o.totalSessions = (o.totalSessions || 0) + 1; const i = localDateKey(new Date), a = o.daily || {}; a[i] = (a[i] || 0) + Math.round(t / 60), o.daily = a; const r = o.techniques = o.techniques || {}, l = r[e] || { totalMinutes: 0, totalBreaths: 0, dayStreak: 0, lastCompletedDay: null, totalSessions: 0 }; l.totalMinutes += t / 60, l.totalBreaths += n || 0, l.totalSessions = (l.totalSessions || 0) + 1; if (l.lastCompletedDay) { const c = dayDiff(parseDateKey(l.lastCompletedDay), parseDateKey(i)); c === 1 ? l.dayStreak = (l.dayStreak || 0) + 1 : c > 1 && (l.dayStreak = 1) } else l.dayStreak = 1; l.lastCompletedDay = i, r[e] = l, o.dayStreak = Math.max(o.dayStreak || 0, l.dayStreak || 0), o.lastCompletedDay = i; const d = o.ach || {}; (o.totalMinutes || 0) >= 10 && (d.m10 = !0), (o.totalMinutes || 0) >= 50 && (d.m50 = !0), (o.totalSessions || 0) >= 5 && (d.s5 = !0), (o.totalBreaths || 0) >= 200 && (d.b200 = !0), o.ach = d; return this.save(o), drawWeeklyChart(), o }, summary() { const e = this.load(); return { minutes: Math.round(e.totalMinutes || 0), breaths: e.totalBreaths || 0, sessions: e.totalSessions || 0, streak: e.dayStreak || 0, daily: e.daily || {}, ach: e.ach || {}, last: e.lastCompletedDay || null } } }; function drawWeeklyChart() { const e = $("#weeklyChart"), t = $("#todayLine"); if (!e && !t) return; const n = MSStats.summary(); if (t) { const i = new Date, a = new Intl.DateTimeFormat(void 0, { weekday: "long", day: "2-digit", month: "long", year: "numeric", hour: "2-digit", minute: "2-digit" }); t.textContent = "Today: " + a.format(i) } if (!e) return; const o = e.getContext("2d"), i = new Date, a = []; for (let r = 6; r >= 0; r--) { const l = new Date(i.getFullYear(), i.getMonth(), i.getDate() - r), d = localDateKey(l); a.push({ label: l.toLocaleDateString(void 0, { weekday: "short" }), v: n.daily[d] || 0, isToday: r === 0 }) } const s = e.width = e.clientWidth || 600, u = e.height = e.clientHeight || 180, y = 28, m = Math.max(10, ...a.map(r => r.v)); o.clearRect(0, 0, s, u), o.fillStyle = "#0a1020", o.fillRect(0, 0, s, u), o.strokeStyle = "rgba(148,163,184,.35)", o.lineWidth = 1; for (let r = 0; r <= 2; r++) { const l = y + r * ((u - y - 10) / 2); o.beginPath(), o.moveTo(40, l), o.lineTo(s - 10, l), o.stroke() } const f = Math.min(60, (s - 80) / a.length - 10); a.forEach((r, l) => { const d = 50 + l * ((s - 100) / a.length), c = Math.max(2, r.v / m * (u - y - 20)), g = u - 20 - c; o.fillStyle = r.isToday ? "rgba(34,197,94,.95)" : "rgba(56,189,248,.85)", o.fillRect(d, g, f, c), o.fillStyle = "#94a3b8", o.font = "12px system-ui,-apple-system,Segoe UI", o.fillText(r.label, d, u - 6) }) } setTimeout(drawWeeklyChart, 60); function loadImg(e) { return new Promise((t, n) => { const o = new Image; o.crossOrigin = "anonymous", o.onload = () => t(o), o.onerror = n, o.src = e }) } async function buildStyledCardCanvas({ canvas: e, includeQR: t = !1 } = {}) { const n = 1224, o = 1584, i = e || Object.assign(document.createElement("canvas"), { width: n, height: o }), a = i.getContext("2d"); try { const r = await loadImg(data.bg || fallbackProfile.bg); a.drawImage(r, 0, 0, n, o) } catch { a.fillStyle = "#111", a.fillRect(0, 0, n, o) } const s = a.createLinearGradient(0, 0, 0, o); s.addColorStop(0, "rgba(0,0,0,.15)"), s.addColorStop(1, "rgba(0,0,0,.55)"), a.fillStyle = s, a.fillRect(0, 0, n, o); const u = 360, y = n / 2, m = 330; a.save(), a.beginPath(), a.arc(y, m, u / 2, 0, Math.PI * 2), a.closePath(), a.fillStyle = "#111", a.fill(); try { const r = await loadImg(data.avatar || fallbackProfile.avatar); a.clip(), a.drawImage(r, y - u / 2, m - u / 2, u, u) } catch { } a.restore(), a.lineWidth = 8, a.strokeStyle = "rgba(255,255,255,.92)", a.beginPath(), a.arc(y, m, u / 2, 0, Math.PI * 2), a.stroke(), a.fillStyle = "#fff", a.textAlign = "center", a.font = "bold 58px ui-sans-serif,system-ui,Segoe UI,Roboto", a.fillText(data.name || "", y, m + u / 2 + 72), a.font = "600 34px ui-sans-serif,system-ui,Segoe UI,Roboto", a.fillStyle = "rgba(255,255,255,.95)", a.fillText(data.title || "", y, m + u / 2 + 120), a.font = "500 28px ui-sans-serif,system-ui,Segoe UI,Roboto", a.fillStyle = "rgba(236,253,245,.94)"; const f = (data.addr || "").split("\n"); f.forEach((r, l) => a.fillText(r, y, m + u / 2 + 170 + l * 34)); const p = [{ label: "ðŸ“ž Call", url: `tel:${data.phone || ""}` }, { label: "ðŸ’¬ Text", url: `sms:${data.phone || ""}` }, { label: "âœ‰ï¸ Email", url: `mailto:${data.email || ""}` }, { label: "ðŸŒ Website", url: data.site || "" }, { label: "ðŸ§˜ Wellbeing", url: data.wellbeing || "" }, { label: "ðŸ¦ Bank details", url: "#bank" }], v = [], b = 160, h = n - 320, k = m + u / 2 + 220, w = 74, S = 16; a.font = "600 28px ui-sans-serif,system-ui,Segoe UI,Roboto", p.forEach((r, l) => { const d = k + l * (w + S); a.fillStyle = "rgba(0,0,0,.45)", a.strokeStyle = "rgba(255,255,255,.35)", a.lineWidth = 2, roundRect(a, b, d, h, w, 14), a.stroke(), a.fill(), a.fillStyle = "#e5f7ff", a.fillText(r.label, y, d + w / 2 + 10), v.push({ x: b, y: d, w: h, h: w, url: r.url }) }); if (t) { const r = location.origin + location.pathname.replace(/[^/]*$/, "") + "pdf.html" + qp, l = await buildQRImage(r, 280), d = n - 320, c = 80; a.drawImage(l, d, c), a.font = "500 22px ui-sans-serif,system-ui,Segoe UI,Roboto", a.fillStyle = "rgba(255,255,255,.95)", a.fillText("Scan: open PDF", d + 140, c + 300), v.push({ x: d, y: c, w: l.width, h: l.height, url: r }) } return { canvas: i, links: v } } function roundRect(e, t, n, o, i, a) { const r = Math.min(a, o / 2, i / 2); e.beginPath(), e.moveTo(t + r, n), e.arcTo(t + o, n, t + o, n + i, r), e.arcTo(t + o, n + i, t, n + i, r), e.arcTo(t, n + i, t, n, r), e.arcTo(t, n, t + o, n, r), e.closePath() } async function buildQRImage(e, t) { const n = new Image; n.crossOrigin = "anonymous", n.referrerPolicy = "no-referrer", n.src = `https://api.qrserver.com/v1/create-qr-code/?size=${t}x${t}&data=${encodeURIComponent(e)}`, await new Promise(o => { n.onload = o, n.onerror = o }); const o = document.createElement("canvas"); o.width = t, o.height = t; const i = o.getContext("2d"); return i.fillStyle = "#fff", i.fillRect(0, 0, t, t), i.drawImage(n, 0, 0, t, t), o } function base64ToBytes(e) { const t = atob(e.replace(/^data:.*;base64,/, "")), n = t.length, o = new Uint8Array(n); for (let i = 0; i < n; i++)o[i] = t.charCodeAt(i); return o } function parseJpegSize(e) { let t = 2; for (; t < e.length;) { if (e[t] !== 255) { t++; continue } const n = e[t + 1], o = (e[t + 2] << 8) | e[t + 3]; if (n >= 192 && n <= 195) return { height: (e[t + 5] << 8) | e[t + 6], width: (e[t + 7] << 8) | e[t + 8] }; t += 2 + o } return { width: 1224, height: 1584 } } async function generateStyledPdf({ fromCanvas: e, links: t = [] }) { const n = e.toDataURL("image/jpeg", .92), o = base64ToBytes(n), i = parseJpegSize(o), a = 595, r = 842, l = `q\n${a} 0 0 ${r} 0 0 cm\n/Im0 Do\nQ\n`, d = [], c = [], g = new TextEncoder; let m = 0; function u(s) { const p = typeof s == "string" ? g.encode(s) : s; c.push(m), d.push(p), m += p.length } function y(s, p) { u(`${s} 0 obj\n`), u(p), u(`\nendobj\n`) } const f = t.filter(s => s.url).map((s, p) => { const v = a / 1224, b = r / 1584, h = s.x * v, k = r - (s.y + s.h) * b, w = (s.x + s.w) * v, S = r - s.y * b; return { rect: [h, k, w, S], url: s.url } }); u("%PDF-1.4\n"), y(1, `<< /Type /Catalog /Pages 2 0 R >>`), y(2, `<< /Type /Pages /Count 1 /Kids [3 0 R] >>`); const b = f.map((s, p) => 6 + p + " 0 R").join(" "); y(3, `<< /Type /Page /Parent 2 0 R /MediaBox [0 0 ${a} ${r}] /Resources << /XObject << /Im0 5 0 R >> /ProcSet [/PDF /ImageC] >> /Contents 4 0 R ${f.length ? "/Annots [" + b + "]" : ""} >>`), y(4, `<< /Length ${l.length} >>\nstream\n${l}endstream`), y(5, `<< /Type /XObject /Subtype /Image /Name /Im0 /Width ${i.width} /Height ${i.height} /ColorSpace /DeviceRGB /BitsPerComponent 8 /Filter /DCTDecode /Length ${o.length} >>\nstream\n`), u(o), u(`\nendstream\nendobj\n`), f.forEach((s, p) => y(6 + p, `<< /Type /Annot /Subtype /Link /Border [0 0 0] /Rect [${s.rect.map(v => v.toFixed(2)).join(" ")}] /A << /S /URI /URI (${s.url}) >> >>`)); const h = m; u("xref\n"); const k = 6 + f.length; u(`0 ${k + 1}\n`), u("0000000000 65535 f \n"); for (let s = 0; s < k; s++)u(String(c[s]).padStart(10, "0") + " 00000 n \n"); return u(`trailer << /Size ${k + 1} /Root 1 0 R >>\nstartxref\n${h}\n%%EOF`), new Blob(d.map(s => s.buffer ? s : new Uint8Array(s)), { type: "application/pdf" }) } async function quickDownloadPdf() { try { const e = await fetch("assets/m_share_profile.pdf").catch(() => null); if (e && e.ok) { const t = await e.blob(), n = document.createElement("a"); return n.href = URL.createObjectURL(t), n.download = "m_share_profile.pdf", document.body.appendChild(n), n.click(), n.remove(), void 0 } } catch { } const t = await buildStyledCardCanvas({ includeQR: !0 }), n = await generateStyledPdf({ fromCanvas: t.canvas, links: t.links }), o = URL.createObjectURL(n), i = document.createElement("a"); i.href = o, i.download = "m_share_profile.pdf", document.body.appendChild(i), i.click(), i.remove(), URL.revokeObjectURL(o) } const LOCK_KEY = "mshare_pdf_locker_v2", MAX_BYTES = 20971520, DeviceLocker = {
    load() { try { return JSON.parse(localStorage.getItem(LOCK_KEY) || "[]") || [] } catch { return [] } }, save(e) { try { localStorage.setItem(LOCK_KEY, JSON.stringify(e)) } catch { } }, usedBytes() { return this.load().reduce((e, t) => e + (t.size || 0), 0) }, formatBytes(e) { return e < 1024 ? `${e} B` : e < 1048576 ? `${(e / 1024).toFixed(1)} KB` : `${(e / 1024 / 1024).toFixed(2)} MB` }, async addBlob(e, t) { const n = await new Promise(o => { const i = new FileReader; i.onload = () => o(String(i.result)), i.readAsDataURL(t) }), o = { name: e || "document.pdf", size: t.size, mime: t.type || "application/pdf", data: n }, i = this.load(); if (this.usedBytes() + t.size > MAX_BYTES) return toast("Locker full â€” delete some files or export."), !1; return i.push(o), this.save(i), !0 }, remove(e) { const t = this.load(); t.splice(e, 1), this.save(t) }, export() { const e = new Blob([localStorage.getItem(LOCK_KEY) || "[]"], { type: "application/json" }), t = document.createElement("a"); t.href = URL.createObjectURL(e), t.download = "mshare_locker_backup.json", document.body.appendChild(t), t.click(), t.remove() }, async import(e) { const t = await e.text(); try { const n = JSON.parse(t); if (!Array.isArray(n)) throw new Error; const o = n.reduce((i, a) => i + (a.size || 0), 0); if (o > MAX_BYTES) { toast("Backup exceeds device quota."); return } this.save(n) } catch { toast("Invalid locker backup.") } }, mount({ listEl: e, quotaEl: t, addInput: n, placeholderBtn: o, exportBtn: i, importInput: a, previewBuilder: r }) {
      const l = () => {
        t && (t.textContent = this.formatBytes(this.usedBytes()) + " / " + this.formatBytes(MAX_BYTES)); const d = this.load(); if (e.innerHTML = "", !d.length) { e.innerHTML = '<div class="muted">No PDFs stored on this device yet.</div>'; return } d.forEach((c, g) => {
          const m = document.createElement("div"); m.className = "kv", m.innerHTML = `<div><b>${c.name || "PDF"}</b> <span class="muted">(${DeviceLocker.formatBytes(c.size || 0)})</span></div>
            <div class="actions" style="margin-top:8px">
              <a class="btn" href="${c.data}" download="${c.name || "document.pdf"}">â¬‡ Download</a>
              <a class="btn" href="${c.data}" target="_blank" rel="noopener">ðŸ”Ž Open</a>
              <button class="btn btn-danger" data-i="${g}">ðŸ—‘ Remove</button>
            </div>`, e.appendChild(m)
        }), e.querySelectorAll("button[data-i]").forEach(d => d.addEventListener("click", () => { this.remove(+d.dataset.i), l() }))
      }; l(), n?.addEventListener("change", async d => { const c = d.target.files?.[0]; if (!c) return; if (c.type !== "application/pdf") { toast("Please choose a PDF."); n.value = ""; return } const g = await this.addBlob(c.name, c); g && l(), n.value = "" }), o?.addEventListener("click", async () => { try { const d = await (typeof r == "function" ? r() : async () => { const c = await buildStyledCardCanvas({ includeQR: !0 }); return generateStyledPdf({ fromCanvas: c.canvas, links: c.links }) })(), c = await this.addBlob("m_share_profile.pdf", d); c && l() } catch { toast("Could not generate placeholder PDF.") } }), i?.addEventListener("click", () => this.export()), a?.addEventListener("change", async d => { const c = d.target.files?.[0]; if (!c) return; await this.import(c), l(), a.value = "" })
    }
  }; function genVCardAndDownload() { const e = ["BEGIN:VCARD", "VERSION:3.0", `FN:${data.name}`, `TITLE:${data.title}`, `TEL;TYPE=CELL:${data.phone}`, `EMAIL;TYPE=WORK:${data.email}`, `URL:${data.site}`, `ADR;TYPE=WORK:;;${(data.addr || "").replace(/\n/g, ";")}`, "END:VCARD"].join("\n"), t = new Blob([e], { type: "text/vcard" }), n = document.createElement("a"); n.href = URL.createObjectURL(t), n.download = "contact.vcf", document.body.appendChild(n), n.click(), n.remove() } function showQrModal() { const e = $("#shareSheet"); e || openShareSheet(); const t = location.origin + location.pathname.replace(/[^/]*$/, "") + "pdf.html" + qp, n = new Image; n.alt = "QR code", n.style = "display:block;margin-top:8px;max-width:280px;border:1px solid var(--b);border-radius:12px;background:#fff", n.src = `https://api.qrserver.com/v1/create-qr-code/?size=280x280&data=${encodeURIComponent(t)}`; const o = $("#shareText"); o && (o.value = makeShareText() + "\n\nQR â†’ " + t, o.parentElement.appendChild(n)), $("#shareSheet")?.classList.add("open") } function toast(e) { try { const t = document.createElement("div"); t.textContent = e, t.style.cssText = "position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#0a1020;color:#e5e7eb;border:1px solid #1f2937;padding:10px 14px;border-radius:10px;z-index:9999;box-shadow:0 10px 30px rgba(0,0,0,.35)", document.body.appendChild(t), setTimeout(() => t.remove(), 1900) } catch { } } window.__MSHARE__ = { data: window.__MSHARE__?.data || data, qp, openShareSheet, genVCardAndDownload, showQrModal, toast, Stats: MSStats, drawWeeklyChart, bankDetailsString, openAppOrStore, buildStyledCardCanvas, generateStyledPdf, quickDownloadPdf, DeviceLocker }; (() => { const e = window.__MSHARE__ = window.__MSHARE__ || {}; async function t(o) { const i = new TextEncoder().encode(o), a = await crypto.subtle.digest("SHA-256", i); return [...new Uint8Array(a)].map(r => r.toString(16).padStart(2, "0")).join("") } const n = "mshare_admin_ok", o = "ea17c32cd4c019ef90f07fa822e744c688db972b823b567344c2aca9a44c6a51"; e.isAdmin = () => sessionStorage.getItem(n) === "1", e.revealStorageLink = () => { document.querySelectorAll('a[data-href="storage.html"]').forEach(i => { i.style.display = "" }) }, e.requireAdmin = async () => { if (e.isAdmin()) return !0; const i = prompt("Enter admin passcode:"); if (!i) return !1; const a = await t(i) === o; return a ? (sessionStorage.setItem(n, "1"), e.revealStorageLink(), !0) : (alert("Incorrect passcode"), !1) }, e.isAdmin() || document.querySelectorAll('a[data-href="storage.html"]').forEach(i => i.remove()), e.CoachPresets = e.CoachPresets || {}, e.CoachPresets.panic = function () { const i = new URLSearchParams({ pattern: "4,4,4,4", minutes: "1", tts: "off", vib: "off" }), a = (e.qp || "").replace(/^\?/, ""), r = a ? a + "&" + i.toString() : i.toString(); return { page: "sos.html", q: r } }; const i = document.getElementById("sosBtn"); i && i.addEventListener("click", a => { setTimeout(() => { /index\.html$|\/$/.test(location.pathname) && (location.href = "sos.html" + (e.qp || "")) }, 0) }, { once: !0 }) })(); const y = $("#year"); y && (y.textContent = (new Date).getFullYear())

  const nav = document.getElementById('mainNav'); if (!nav) return;
  const groups = nav.querySelectorAll('.menu-group');
  groups.forEach(g => {
    const b = g.querySelector('.menu-toggle'); if (!b) return;
    b.addEventListener('click', (ev) => {
      ev.preventDefault();
      const open = g.classList.toggle('open');
      b.setAttribute('aria-expanded', open ? 'true' : 'false');
      // Accordion behaviour (one open at a time) on all viewports
      if (open) {
        groups.forEach(o => { if (o !== g) { o.classList.remove('open'); const ob = o.querySelector('.menu-toggle'); ob && ob.setAttribute('aria-expanded', 'false'); } });
      }
    });
  });
  document.addEventListener('click', (e) => {
    if (!nav.contains(e.target)) {
      groups.forEach(o => { o.classList.remove('open'); const ob = o.querySelector('.menu-toggle'); ob && ob.setAttribute('aria-expanded', 'false'); });
    }
  });
})();

// Admin hash override: ensure the new passcode takes effect without touching minified block above
; (() => {
  try {
    const MS = window.__MSHARE__ = window.__MSHARE__ || {};
    const KEY = "mshare_admin_ok";
    const NEW_HASH = "7ecee5122a3e96f7422e3757dcab88e58f3fc8dd5a65e6aa593fb027e41e2a9b";
    async function sha256Hex(str) {
      const bytes = new TextEncoder().encode(str);
      const digest = await crypto.subtle.digest('SHA-256', bytes);
      return [...new Uint8Array(digest)].map(b => b.toString(16).padStart(2, '0')).join('');
    }
    // Override to use the new hash
    MS.isAdmin = () => sessionStorage.getItem(KEY) === '1';
    MS.requireAdmin = async () => {
      if (MS.isAdmin()) return true;
      const input = prompt('Enter admin passcode:');
      if (!input) return false;
      const raw = String(input).trim();
      const lower = raw.toLowerCase();
      const isHex64 = /^[0-9a-f]{64}$/.test(lower);
      // Accept either the plaintext (hash equals NEW_HASH) or the hash pasted directly
      const ok = (isHex64 && lower === NEW_HASH) || (await sha256Hex(raw)) === NEW_HASH;
      if (ok) {
        sessionStorage.setItem(KEY, '1');
        try { typeof MS.revealStorageLink === 'function' && MS.revealStorageLink(); } catch { }
        return true;
      }
      alert('Incorrect passcode');
      return false;
    };
  } catch { }
})();
