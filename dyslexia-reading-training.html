<!doctype html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta charset="utf-8" />
  <title>Dyslexia Reading Training ‚Ä¢ M Share</title>
  <meta name="description" content="Free, structured reading practice ideas paired with calming breath tools and adult-friendly micro-exercises." />

  <!-- Site styles you already ship -->
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="assets/css/header-2025.css" />
  <link rel="stylesheet" href="assets/css/footer-2025.css" />
  <link rel="stylesheet" href="assets/css/ux-fixes.css" />
  <link rel="stylesheet" href="assets/css/responsive-fixes.css" />

  <!-- Brand / theme variables and high-contrast fixes -->
  <style id="mpl-theme-vars-css-v4">
    :root{
      --bg:#f7f7fb;
      --fg:#0b0d10;
      --muted:#475569;
      --b:rgba(0,0,0,.12);
      --brightness:1;

      /* Button colour variables (auto-mapped to site buttons on load) */
      --btn-bg:#0ea5e9;         /* fallback ‚Äî will be replaced at runtime */
      --btn-fg:#ffffff;         /* fallback ‚Äî will be replaced at runtime */
      --btn-success-bg:#22c55e; /* fallback ‚Äî will be replaced at runtime */
      --btn-danger-bg:#ef4444;  /* fallback ‚Äî will be replaced at runtime */

      /* Focus-screen and highlight */
      --focus-backdrop:rgba(0,0,0,.55);
      --focus-card:#ffffff;
      --focus-accent:var(--btn-bg);
      --focus-text:#0b0d10;

      color-scheme:light dark;
    }
    html{background:var(--bg);color:var(--fg);filter:brightness(var(--brightness))}
    body{background:transparent}
    .card{background:#fff;color:#0b0d10;border:1px solid var(--b);border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .muted{color:var(--muted)}
    /* Buttons harmonised to brand colours */
    .btn{background:var(--btn-bg);color:var(--btn-fg);border:none;border-radius:10px;padding:.55rem .9rem;font-weight:600}
    .btn:hover{filter:brightness(0.96)}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .btn-success{background:var(--btn-success-bg);color:#fff}
    .btn-danger{background:var(--btn-danger-bg);color:#fff}
    /* Readability for paced/highlighted text */
    .pacer-current{font-weight:800;padding:.08em .18em;border-radius:.35rem;
      background:linear-gradient(180deg, rgba(255,255,0,.30), rgba(255,255,0,.15))}
    .pacer-prev{opacity:.7}
    .pacer-muted{opacity:.35}
    /* 2% spacing framework */
    :root{--dlx-gap:clamp(10px,2vw,24px)}
    main.container#dlxPage{padding:var(--dlx-gap)}
    #dlxPage .card{margin:var(--dlx-gap) 0;padding:calc(var(--dlx-gap)*.75)}
    #dlxPage .actions{display:flex;flex-wrap:wrap;gap:calc(var(--dlx-gap)*.5)}
    #dlxPage .row-actions{display:flex;flex-wrap:wrap;gap:calc(var(--dlx-gap)*.5)}
    .grid{display:grid;gap:calc(var(--dlx-gap)*.5)}
    .grid-2-cols{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:calc(var(--dlx-gap)*.6)}
    .grid-3-cols{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:calc(var(--dlx-gap)*.6)}
    @media (max-width:900px){.grid-3-cols{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:560px){
      .grid-2-cols,.grid-3-cols{grid-template-columns:1fr}
      #dlxPage .card{padding:calc(var(--dlx-gap)*.6)}
    }
  </style>

  <!-- Focus Screen (separate files + inline fallback) -->
  <link rel="stylesheet" href="assets/css/focus-screen.css" />
  <style id="focus-screen-css-inline">
    /* fallback if external CSS not found */
    #focusScreen{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:var(--focus-backdrop);z-index:99999;padding:18px}
    #focusScreen[aria-hidden="false"]{display:flex}
    .fs-card{width:min(96vw,920px);max-height:92vh;overflow:auto;background:var(--focus-card);
      color:var(--focus-text);border-radius:16px;border:1px solid var(--b);box-shadow:0 20px 40px rgba(0,0,0,.25)}
    .fs-head{display:flex;align-items:center;gap:10px;padding:16px 18px;border-bottom:1px solid var(--b)}
    .fs-pill{font-weight:700;font-size:.8rem;padding:.18rem .5rem;border-radius:999px;background:var(--focus-accent);color:#fff}
    .fs-body{padding:16px 18px}
    .fs-footer{display:flex;gap:10px;justify-content:flex-end;padding:14px 18px;border-top:1px solid var(--b)}
    .fs-mini{display:flex;gap:12px;flex-wrap:wrap;margin-top:.2rem}
    .fs-kpi{background:#f8fafc;border:1px solid var(--b);border-radius:10px;padding:.35rem .6rem;font-weight:600}
    .fs-note{color:var(--muted);font-size:.95rem}
  </style>

  <!-- Canonical header/footer scripts -->
  <script src="assets/header/header.js"></script>
  <script src="assets/footer/footer.js"></script>

  <!-- Desktop nav enhancer (unchanged public API; brace-balanced) -->
  <style id="mpl-desktop-nav-css-v3">
    @media (min-width:1025px){
      .mpl-nav-toggle{display:inline-flex;align-items:center;gap:.25rem;background:none;border:0;padding:.25rem;margin-left:.25rem;cursor:pointer;line-height:1}
      .mpl-nav-toggle:focus,.mpl-nav-toggle:focus-visible{outline:2px solid currentColor;outline-offset:2px}
      [data-mpl-submenu]{display:none;visibility:hidden}
      [data-mpl-open="true"]>[data-mpl-submenu]{display:block;visibility:visible}
      .mpl-chevron{display:inline-block;transform:rotate(0deg);transition:transform .2s ease}
      [data-mpl-open="true"] .mpl-chevron{transform:rotate(180deg)}
      .mpl-sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    }
  </style>
  <script id="mpl-desktop-nav-js-v3">
    (()=>{const mq=matchMedia('(min-width:1025px)');let enabled=false;let cleanups=[];const q=(s,c=document)=>Array.from(c.querySelectorAll(s));
      function findSubmenu(el){return el.querySelector(':scope > .submenu, :scope > [role="menu"], :scope > ul, :scope > .dropdown-menu, :scope > ol')}
      function findTop(){const navs=q('header nav, nav[role="navigation"], nav.primary, .navbar nav, nav');const groups=new Set();navs.forEach(n=>{const top=[];const ul=n.querySelector(':scope > ul');if(ul)top.push(...Array.from(ul.children));else top.push(...Array.from(n.children));top.forEach(node=>{const sub=findSubmenu(node);if(sub)groups.add(node)})});return Array.from(groups)}
      function closeAll(ex){q('[data-mpl-open="true"]').forEach(g=>{if(ex&&g===ex)return;g.setAttribute('data-mpl-open','false');const t=g.querySelector(':scope > .mpl-nav-toggle');if(t)t.setAttribute('aria-expanded','false')})}
      function enhance(){if(enabled)return;enabled=true;const groups=findTop();if(!groups.length)return;groups.forEach(group=>{const submenu=findSubmenu(group);if(!submenu)return;submenu.setAttribute('data-mpl-submenu','true');group.setAttribute('data-mpl-nav-group','true');if(!group.hasAttribute('data-mpl-open'))group.setAttribute('data-mpl-open','false');let label=group.querySelector(':scope > a, :scope > button, :scope > [role="button"], :scope > .label, :scope > .menu-label');if(!label)label=group.firstElementChild;let toggle=group.querySelector(':scope > .mpl-nav-toggle');if(!toggle){toggle=document.createElement('button');toggle.type='button';toggle.className='mpl-nav-toggle';toggle.setAttribute('aria-haspopup','menu');toggle.setAttribute('aria-expanded','false');toggle.setAttribute('title','Toggle submenu');toggle.innerHTML='<span class="mpl-chevron" aria-hidden="true">‚ñæ</span><span class="mpl-sr-only">Toggle submenu</span>';if(label&&label.nextSibling)group.insertBefore(toggle,label.nextSibling);else group.appendChild(toggle)}
        const open=()=>{if(!mq.matches)return;closeAll(group);group.setAttribute('data-mpl-open','true');toggle.setAttribute('aria-expanded','true')};
        const close=()=>{if(!mq.matches)return;group.setAttribute('data-mpl-open','false');toggle.setAttribute('aria-expanded','false')};
        const onEnter=()=>open();
        const onLeave=e=>{const rel=e.relatedTarget;if(rel&&group.contains(rel))return;close()};
        const onToggle=e=>{if(!mq.matches)return;e.preventDefault();const isOpen=group.getAttribute('data-mpl-open')==='true';isOpen?close():open()};
        const onKeys=e=>{if(!mq.matches)return;if(e.key==='Enter'||e.key===' '){e.preventDefault();onToggle(e)}else if(e.key==='Escape'){e.preventDefault();close();toggle.focus()}}
        group.addEventListener('mouseenter',onEnter);group.addEventListener('mouseleave',onLeave);toggle.addEventListener('click',onToggle);toggle.addEventListener('keydown',onKeys);
        cleanups.push(()=>{group.removeEventListener('mouseenter',onEnter);group.removeEventListener('mouseleave',onLeave);toggle.removeEventListener('click',onToggle);toggle.removeEventListener('keydown',onKeys)})});
        const onDocClick=e=>{if(!mq.matches)return;const openEl=document.querySelector('[data-mpl-open="true"]');if(!openEl)return;if(openEl.contains(e.target))return;openEl.setAttribute('data-mpl-open','false');const t=openEl.querySelector(':scope > .mpl-nav-toggle');if(t)t.setAttribute('aria-expanded','false')};
        const onDocEsc=e=>{if(!mq.matches)return;if(e.key==='Escape'){const openEl=document.querySelector('[data-mpl-open="true"]');if(!openEl)return;openEl.setAttribute('data-mpl-open','false');const t=openEl.querySelector(':scope > .mpl-nav-toggle');if(t){t.setAttribute('aria-expanded','false');t.focus()}}};
        document.addEventListener('click',onDocClick);document.addEventListener('keydown',onDocEsc);
        cleanups.push(()=>{document.removeEventListener('click',onDocClick);document.removeEventListener('keydown',onDocEsc)});
      }
      function teardown(){if(!enabled)return;closeAll();cleanups.forEach(fn=>{try{fn()}catch{}});cleanups=[];enabled=false}
      const react=()=>{mq.matches?enhance():teardown()}; if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',react);else react(); mq.addEventListener('change',react);
    })();
  </script>

  <!-- SEO -->
  <link rel="canonical" href="https://www.mindpaylink.com/dyslexia-reading-training.html" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="M Share" />
  <meta property="og:title" content="Dyslexia Reading Training ‚Ä¢ M Share" />
  <meta property="og:description" content="Free, structured reading practice ideas paired with calming breath tools and adult-friendly micro-exercises." />
  <meta property="og:url" content="https://www.mindpaylink.com/dyslexia-reading-training.html" />
  <meta property="og:image" content="https://www.mindpaylink.com/icons/logo-wordmark-800x200.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Dyslexia Reading Training ‚Ä¢ M Share" />
  <meta name="twitter:description" content="Free, structured reading practice ideas paired with calming breath tools and adult-friendly micro-exercises." />
  <meta name="twitter:image" content="https://www.mindpaylink.com/icons/logo-wordmark-800x200.png" />
  <script type="application/ld+json">
    {"@context":"https://schema.org","@type":"WebSite","name":"M Share","url":"https://www.mindpaylink.com/"}
  </script>

  <!-- Readability / Dyslexia font toggle -->
  <style id="dlx-accessibility-vars">
    :root{--dlx-line-height:1.6;--dlx-letter-spacing:.05em;--dlx-word-spacing:.12em;--dlx-font-stack:Arial,system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    html.dlx-font-loaded{--dlx-font-stack:'Open Dyslexic',Arial,system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    body{line-height:var(--dlx-line-height);letter-spacing:var(--dlx-letter-spacing);word-spacing:var(--dlx-word-spacing);font-family:var(--dlx-font-stack)}
    .dlx-standard-text{line-height:1.5;letter-spacing:normal;word-spacing:normal;font-family:inherit}
  </style>
  <script id="dlx-font-loader">
    (function(){ if(!('fonts' in document) || typeof FontFace==='undefined')return;
      try{var ff=new FontFace('Open Dyslexic',"url(assets/fonts/OpenDyslexic-Regular.woff2) format('woff2')",{weight:'400',style:'normal',display:'swap'});
        ff.load().then(function(f){try{document.fonts.add(f)}catch(e){};document.documentElement.classList.add('dlx-font-loaded')}).catch(function(){});
      }catch(e){}
    })();
  </script>
</head>

<body>
  <!-- Focus Screen container (DOM) -->
  <div id="focusScreen" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="fs-card" role="document" aria-labelledby="fsTitle">
      <div class="fs-head">
        <span class="fs-pill" id="fsMode">FOCUS</span>
        <h3 id="fsTitle" style="margin:0">Training</h3>
      </div>
      <div class="fs-body">
        <div class="fs-mini">
          <div class="fs-kpi">Timer: <span id="fsTimer">00:00</span></div>
          <div class="fs-kpi">Tool: <span id="fsTool">‚Äî</span></div>
        </div>
        <p class="fs-note" id="fsNote">Keep it calm and steady. You can pause anytime.</p>
        <div id="fsSlot"><!-- tool can inject live panel here --></div>
      </div>
      <div class="fs-footer">
        <button type="button" class="btn" id="fsPause">Pause</button>
        <button type="button" class="btn btn-success" id="fsResume" style="display:none">Resume</button>
        <button type="button" class="btn btn-danger" id="fsEnd">End</button>
      </div>
    </div>
  </div>

  <header class="site-header">
    <div class="container navbar">
      <a id="brandLink" class="brand" data-href="index.html" href="index.html">
        <span class="logo logo-blue">M</span><span class="brand-text">M Share</span>
      </a>

      <nav class="main-nav" id="mainNav">
        <a data-href="index.html">Wellbeing</a>
        <div class="menu-group">
          <button class="menu-toggle" aria-expanded="false">Conditions <span class="icon">‚ñæ</span></button>
          <div class="submenu">
            <div class="menu-label">Neurodevelopmental</div>
            <a data-href="autism.html">Autism</a>
            <a data-href="autism-parent.html">Autism Parent</a>
            <a data-href="adhd.html">ADHD</a>
            <a data-href="dyslexia-reading-training.html">Dyslexia</a>
            <div class="menu-label">Mental Health</div>
            <a data-href="anxiety.html">Anxiety</a>
            <a data-href="depression.html">Depression</a>
            <a data-href="stress.html">Stress</a>
            <a data-href="sleep.html">Sleep</a>
          </div>
        </div>
        <div class="menu-group">
          <button class="menu-toggle" aria-expanded="false">Breathing &amp; Focus <span class="icon">‚ñæ</span></button>
          <div class="submenu">
            <div class="menu-label">Guides</div>
            <a data-href="breath.html">Breath (how-to)</a>
            <a data-href="focus.html">Focus</a>
            <a data-href="mindfulness.html">Mindfulness</a>
            <div class="menu-label">Techniques</div>
            <a data-href="sos-60.html">60-second Reset</a>
            <a data-href="box-breathing.html">Box Breathing</a>
            <a data-href="4-7-8-breathing.html">4-7-8 Breathing</a>
            <a data-href="coherent-5-5.html">Coherent 5-5</a>
          </div>
        </div>
        <div class="menu-group">
          <button class="menu-toggle" aria-expanded="false">Toolkits <span class="icon">‚ñæ</span></button>
          <div class="submenu">
            <div class="menu-label">General</div>
            <a data-href="sleep-tools.html">Sleep Tools</a>
            <a data-href="breath-tools.html">Breath Tools</a>
            <a data-href="mood-tools.html">Mood Tools</a>
            <div class="menu-label">Condition-specific</div>
            <a data-href="adhd-tools.html">ADHD Tools</a>
            <a data-href="autism-tools.html">Autism Tools</a>
            <a data-href="depression-tools.html">Depression Tools</a>
            <a data-href="anxiety-tools.html">Anxiety Tools</a>
            <a data-href="stress-tools.html">Stress Tools</a>
          </div>
        </div>
        <div class="menu-group">
          <button class="menu-toggle" aria-expanded="false">About <span class="icon">‚ñæ</span></button>
          <div class="submenu">
            <a data-href="about.html">About</a>
            <a data-href="coffee.html">Support Us</a>
            <a data-href="contact.html">Contact</a>
          </div>
        </div>
      </nav>

      <button type="button" id="navToggle" class="nav-toggle" aria-label="Menu" aria-expanded="false" aria-controls="mainNav">‚ò∞</button>
    </div>
  </header>

  <a id="top" style="position:absolute;top:0;left:0;width:0;height:0;overflow:hidden"> </a>

  <main class="container" id="dlxPage">

    <!-- mshare:value-pack:start -->
    <section class="card mshare-value-pack" id="vp-cond-overview">
      <h2>Dyslexia ‚Äî quick overview</h2>
      <p>Dyslexia is a difference in processing written language, often affecting phonology, decoding, and working memory.</p>
      <h3>Common signs</h3>
      <ul><li>Slow/effortful reading</li><li>Spelling difficulties</li><li>Mixing up similar letter sounds</li></ul>
      <h3>How to use this site</h3>
      <ol><li>Use silent modes in reading practice</li><li>Pair 1-min breath breaks with reading</li><li>Share printable reading support sheets</li></ol>
      <div class="actions">
        <a class="btn" href="sos-60.html?minutes=1">Try SOS-60</a>
        <a class="btn" href="breath.html">Breath basics</a>
      </div>
      <h3>Credible recommendations (UK)</h3>
      <ul><li><a href="https://www.nhs.uk/conditions/dyslexia/" rel="noopener">NHS: Dyslexia</a></li><li><a href="https://www.bdadyslexia.org.uk/" rel="noopener">British Dyslexia Association</a></li></ul>
      <p class="muted">Supportive information only; not medical advice.</p>
      <div class="actions" style="margin-top:8px">
        <button type="button" class="btn" data-mpl-prog="dyslexia-reading-training">Mark 1 min practised</button>
        <span class="badge" id="mpl-prog-dyslexia-reading-training">Completed: 0</span>
      </div>
      <script>
        (()=>{try{
          const key='mpl.progress.dyslexia-reading-training.count';
          const el=document.getElementById('mpl-prog-dyslexia-reading-training');
          const btn=document.querySelector('[data-mpl-prog="dyslexia-reading-training"]');
          const get=()=>Number(localStorage.getItem(key)||0);
          const set=v=>localStorage.setItem(key,String(v));
          const paint=()=>{if(el)el.textContent='Completed: '+get()};
          paint(); btn&&btn.addEventListener('click',()=>{set(get()+1);paint()});
        }catch(e){}})();
      </script>
    </section>
    <!-- mshare:value-pack:end -->

    <!-- Quick starter -->
    <section id="mpl-dyslexia-quick-card" class="card" style="margin-bottom:1.25rem">
      <h2>Quick Starter: Dyslexia</h2>
      <p class="muted" style="margin-top:-.25rem">Educational information only ‚Äî not a diagnosis or medical advice.</p>

      <div class="grid-2-cols" style="gap:1rem">
        <div>
          <h3>What it is</h3>
          <p>A learning difference that primarily affects reading and spelling, often linked to phonological processing.</p>
          <h3>Possible signs</h3>
          <ul><li>Slow or effortful reading; difficulty with fluent decoding</li><li>Trouble recognising or manipulating speech sounds</li><li>Spelling that varies (even within the same piece)</li><li>Avoiding reading-heavy tasks; fatigue after reading</li></ul>
          <h3>Trusted resources</h3>
          <ul><li><a href="https://www.nhs.uk/conditions/dyslexia/" rel="noopener">NHS ‚Äì Dyslexia overview</a></li></ul>
        </div>

        <div>
          <h3>Use this site for Dyslexia</h3>
          <ul><li>Warm up with a 60-second breath to reduce stress before reading.</li><li>Use the Dyslexia page routines; keep practice short and regular.</li><li>Track sessions and celebrate small gains to build confidence.</li></ul>
          <div class="actions" style="margin-top:.5rem">
            <a class="btn" href="box-breathing.html" rel="noopener">üü© Box Breathing</a>
            <a class="btn" href="4-7-8-breathing.html" rel="noopener">üü¶ 4-7-8 Breathing</a>
            <a class="btn" href="coherent-5-5.html" rel="noopener">üü™ Coherent 5-5</a>
            <a class="btn btn-danger" href="sos-60.html" rel="noopener">üÜò 60-second SOS</a>
          </div>

          <h3 style="margin-top:.75rem">Progress (local only)</h3>
          <div class="badge">Sessions: <span id="mpl-dyslexia-sess">0</span></div>
          <div class="badge">Minutes:  <span id="mpl-dyslexia-mins">0</span></div>
          <div class="badge">Last used: <span id="mpl-dyslexia-last">‚Äî</span></div>
          <div class="actions" style="margin-top:.5rem">
            <button type="button" class="btn" id="mpl-dyslexia-start">Start session</button>
            <button type="button" class="btn" id="mpl-dyslexia-stop" disabled>Stop &amp; save</button>
            <span class="muted" id="mpl-dyslexia-timer" style="margin-left:.5rem">00:00</span>
          </div>
        </div>
      </div>

      <script>
        (function(){
          const key='mpl.progress.dyslexia';
          const el={s:document.getElementById('mpl-dyslexia-sess'),
                    m:document.getElementById('mpl-dyslexia-mins'),
                    l:document.getElementById('mpl-dyslexia-last'),
                    start:document.getElementById('mpl-dyslexia-start'),
                    stop:document.getElementById('mpl-dyslexia-stop'),
                    t:document.getElementById('mpl-dyslexia-timer')};
          function load(){try{return Object.assign({sessions:0,minutes:0,last:null,startedAt:null},JSON.parse(localStorage.getItem(key)||'{}'))}catch(e){return {sessions:0,minutes:0,last:null,startedAt:null}}}
          function save(v){try{localStorage.setItem(key,JSON.stringify(v))}catch(e){}}
          function fmtMin(n){return Math.max(0,Math.round(n))}
          function fmtTime(ms){const s=Math.floor(ms/1000);const mm=String(Math.floor(s/60)).padStart(2,'0');const ss=String(s%60).padStart(2,'0');return mm+':'+ss}
          let state=load(), tickId=null;
          function reflect(){if(el.s)el.s.textContent=String(state.sessions);if(el.m)el.m.textContent=String(fmtMin(state.minutes));if(el.l)el.l.textContent=state.last?new Date(state.last).toLocaleString():'‚Äî';if(el.start)el.start.disabled=!!state.startedAt;if(el.stop)el.stop.disabled=!state.startedAt}
          function start(){ if(state.startedAt)return; state.startedAt=Date.now(); save(state); reflect();
            tickId=setInterval(()=>{if(el.t)el.t.textContent=fmtTime(Date.now()-state.startedAt)},1000)}
          function stop(){ if(!state.startedAt)return; const durMin=(Date.now()-state.startedAt)/60000;
            state.minutes=Math.max(0,(state.minutes||0)+durMin); state.sessions=(state.sessions||0)+1; state.last=new Date().toISOString(); state.startedAt=null; save(state); reflect();
            if(tickId){clearInterval(tickId);tickId=null} if(el.t)el.t.textContent='00:00'}
          el.start&&el.start.addEventListener('click',start);
          el.stop&&el.stop.addEventListener('click',stop);
          reflect();
        })();
      </script>
    </section>

    <h1>Dyslexia: Reading Training</h1>
    <div class="row-actions" style="margin:6px 0 12px">
      <button class="btn btn-success" id="btnAddCoachDys" type="button">‚ûï Add to app</button>
      <button class="btn" id="btnOpenCoachDys" type="button">‚ñ∂Ô∏è Open coach now</button>
      <a class="btn" data-href="coach.html">Coach hub</a>
    </div>

    <div class="card">
      <p>These are practical, low-pressure routines that blend <strong>paced breathing</strong> with <strong>sound, word, and visual-scanning practice</strong>. The aim is steadier focus, less overload, and small wins that add up. Adapt minutes, difficulty, and text to suit the person.</p>
      <p class="muted">Educational information only; not medical advice or a diagnosis.</p>
    </div>

    <!-- 0) Before practice -->
    <h2 id="beforePractice">Before practice (1‚Äì2 minutes)</h2>
    <ul>
      <li>Do one calming breath: <strong>4-7-8</strong> (inhale 4s, hold 7s, exhale 8s) or <strong>Coherent 5-5</strong> (inhale 5s, exhale 5s).</li>
      <li class="no-list-margin">
        <div class="actions">
          <a class="btn btn-success" href="4-7-8-breathing.html">Start 4-7-8 Breathing</a>
          <a class="btn btn-success" href="coherent-5-5.html">Start Coherent 5-5</a>
        </div>
      </li>
      <li>Pick a <em>tiny</em> goal (e.g., 60 seconds, 3 words, or 2 short lines).</li>
      <li>Stop while it still feels easy‚Äî<em>bank the win</em> and come back tomorrow.</li>
    </ul>

    <!-- 1) Phonological awareness -->
    <div class="card" id="sec-phon">
      <h3>1) Phonological awareness</h3>
      <p class="muted"><strong>Why it helps:</strong> noticing, separating, and blending sounds builds a base for decoding new words.</p>

      <h4>Sound map</h4>
      <p>Choose 3‚Äì5 graphemes (e.g., <em>a, sh, ai</em>). Point to a tile out of order and say its sound. Do 3 slow breaths, then a quick re-run.</p>

      <h4>Segment ‚Üí Blend (how to blend slowly)</h4>
      <ol>
        <li><strong>Stretch the sounds</strong> with a finger count: <em>/k/</em> (1) ‚Äî <em>/a/</em> (2) ‚Äî <em>/t/</em> (3).</li>
        <li><strong>Blend forward:</strong> say the first two together (<em>ka‚Ä¶</em>), then pull in the last (<em>kat</em> ‚Üí ‚Äú<em>cat</em>‚Äù).</li>
        <li><strong>Use a breath cue:</strong> inhale before the first sound, exhale gently through the blend to avoid rushing.</li>
        <li><strong>Swap roles:</strong> partner segments while you blend.</li>
      </ol>

      <!-- Voice Coach ‚Äî Segment & Blend -->
      <div id="vcPhon" class="card" aria-labelledby="vcPhonH">
        <h4 id="vcPhonH">Voice Coach ‚Äî Segment &amp; Blend</h4>
        <p class="muted">Type a word and let the coach model slow sounds then the whole word.</p>
        <div class="grid-3-cols">
          <div class="tile"><label for="vcWord">Word</label><input id="vcWord" type="text" value="cat" title="Input" placeholder=" "></div>
          <div class="tile"><label for="vcPace">Pace</label>
            <select id="vcPace" title="Select option">
              <option value="slow">Slow</option>
              <option value="med" selected>Medium</option>
              <option value="fast">Fast</option>
            </select>
          </div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="vcPlay" class="btn btn-success" type="button">Model segment‚Üíblend</button>
              <button id="vcStop" class="btn" type="button" disabled>Stop</button>
            </div>
          </div>
        </div>
        <div id="vcOut" class="muted" style="margin-top:6px"></div>
      </div>

      <p style="margin-top:10px"><strong>How to run (1‚Äì3 min):</strong> show the set, speak the sound, read two quick example words, then hide and recall.</p>

      <!-- Sound Training Studio -->
      <div id="svStudio" class="card" aria-labelledby="svStudioH">
        <h4 id="svStudioH">Sound Training Studio (Audio ‚Ä¢ Visual ‚Ä¢ Mirror)</h4>
        <p class="muted">Select a topic, click a sound to hear examples, and‚Äîif helpful‚Äîopen the mirror to watch mouth shape.</p>
        <div class="grid-3-cols">
          <div class="tile"><label for="svSelect">Topic</label>
            <select id="svSelect" title="Select option">
              <option value="short" selected>Short vowels</option>
              <option value="long">Long vowels</option>
              <option value="digraphs">Digraphs / trigraphs</option>
              <option value="teams">Vowel teams</option>
              <option value="r">R-controlled</option>
              <option value="silent">Silent letters</option>
            </select>
          </div>
          <div class="tile"><label for="ttsVoice">Voice</label>
            <select id="ttsVoice" title="Select option">
              <option value="uk-auto" selected>Auto (best UK)</option>
              <option value="uk-f">British Female</option>
              <option value="uk-m">British Male (‚ÄúDaniel‚Äù if available)</option>
              <option value="system">System default</option>
            </select>
          </div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="svPractice" class="btn btn-success" type="button" disabled>Practice all</button>
              <button id="svStop" class="btn" type="button" disabled>Stop</button>
            </div>
          </div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="svCam" class="btn" type="button">Open mirror</button>
              <button id="svCamOff" class="btn" type="button" disabled>Close mirror</button>
            </div>
          </div>
        </div>
        <div id="svTiles" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(84px,1fr));gap:8px"></div>
        <div id="svOut" class="muted" style="margin-top:8px"></div>
        <div id="svMirrorWrap" class="card" style="margin-top:10px;display:none" aria-label="Mirror camera preview">
          <video id="svMirror" autoplay playsinline muted style="width:100%;border-radius:12px;background:#000"></video>
          <p class="muted" style="margin-top:6px">Use this as a mirror while you say the sounds.</p>
        </div>
      </div>

      <div class="card">
        <h4>Pronunciation coaching (quick cues)</h4>
        <ul>
          <li><strong>Mouth shape:</strong> long vowels stretch; short vowels are quick and centred.</li>
          <li><strong>Voicing:</strong> throat vibrates for voiced sounds (<em>/z/</em>), not for unvoiced (<em>/s/</em>).</li>
          <li><strong>Airflow:</strong> <em>sh</em> is a long, quiet stream; <em>ch</em> starts with a tiny stop then a release.</li>
        </ul>
      </div>
    </div>

    <!-- 2) GP mapping ‚Äî 2√ó3 grid -->
    <div class="card" id="sec-gp">
      <h3>2) Grapheme‚Äìphoneme practice (GP mapping)</h3>
      <p class="muted"><strong>Why it helps:</strong> fluent mapping turns symbols into reliable sounds.</p>
      <p><strong>Rotate sets over the week.</strong> Keep each mini-set short (3‚Äì6 items).</p>

      <style>
        #sec-gp .grid-2-cols{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
        @media (max-width:560px){#sec-gp .grid-2-cols{grid-template-columns:1fr}}
      </style>

      <div class="grid-2-cols">
        <div class="tile">
          <h4>Short vowels</h4>
          <ul>
            <li><strong>a</strong> /a/ ‚Äî <em>cat, map</em></li>
            <li><strong>e</strong> /e/ ‚Äî <em>bed, hem</em></li>
            <li><strong>i</strong> /i/ ‚Äî <em>sit, milk</em></li>
            <li><strong>o</strong> /o/ ‚Äî <em>hot, pond</em></li>
            <li><strong>u</strong> /u/ ‚Äî <em>sun, drum</em></li>
          </ul>
        </div>

        <div class="tile">
          <h4>Long vowels</h4>
          <ul>
            <li><strong>a</strong> /ƒÅ/ ‚Äî <em>late, paper</em></li>
            <li><strong>e</strong> /ƒì/ ‚Äî <em>tree, even</em></li>
            <li><strong>i</strong> /ƒ´/ ‚Äî <em>time, pilot</em></li>
            <li><strong>o</strong> /≈ç/ ‚Äî <em>home, open</em></li>
            <li><strong>u</strong> /yoo/ ‚Äî <em>unit, music</em></li>
          </ul>
        </div>

        <div class="tile">
          <h4>Digraphs / trigraphs</h4>
          <p class="muted"><em>sh, ch, th, ph, wh, igh, tch, dge</em></p>
          <ul>
            <li><strong>sh</strong> ‚Äî <em>ship, brush</em></li>
            <li><strong>ch</strong> ‚Äî <em>chat, teacher</em></li>
            <li><strong>th</strong> (/Œ∏/ or /√∞/) ‚Äî <em>thin, this</em></li>
            <li><strong>ph</strong> ‚Äî <em>phone, graph</em></li>
            <li><strong>wh</strong> ‚Äî <em>when, whale</em></li>
            <li><strong>igh</strong> ‚Äî <em>high, night</em></li>
            <li><strong>tch</strong> ‚Äî <em>catch, match</em></li>
            <li><strong>dge</strong> ‚Äî <em>bridge, edge</em></li>
          </ul>
        </div>

        <div class="tile">
          <h4>Vowel teams</h4>
          <p class="muted"><em>ai/ay, ee/ea, oa/ow, oi/oy, ou/ow, au/aw</em></p>
          <ul>
            <li><strong>ai/ay</strong> ‚Äî <em>rain / day</em></li>
            <li><strong>ee/ea</strong> ‚Äî <em>see / team</em></li>
            <li><strong>oa/ow</strong> ‚Äî <em>boat / snow</em></li>
            <li><strong>oi/oy</strong> ‚Äî <em>coin / boy</em></li>
            <li><strong>ou/ow</strong> ‚Äî <em>sound / cloud</em></li>
            <li><strong>au/aw</strong> ‚Äî <em>cause / saw</em></li>
          </ul>
        </div>

        <div class="tile">
          <h4>R-controlled vowels</h4>
          <p class="muted"><em>ar, er, ir, or, ur</em></p>
          <ul>
            <li><strong>ar</strong> ‚Äî <em>car, start</em></li>
            <li><strong>er/ir/ur</strong> ‚Äî <em>her, bird, turn</em></li>
            <li><strong>or</strong> ‚Äî <em>fork, north</em></li>
          </ul>
        </div>

        <div class="tile">
          <h4>Silent letters</h4>
          <p class="muted"><em>kn/gn, wr, mb, igh, tch</em></p>
          <ul>
            <li><strong>kn/gn</strong> ‚Äî <em>knee, gnome</em></li>
            <li><strong>wr</strong> ‚Äî <em>write, wrist</em></li>
            <li><strong>mb</strong> ‚Äî <em>thumb, comb</em></li>
            <li><strong>igh</strong> ‚Äî <em>light</em> (single sound /ƒ´/)</li>
          </ul>
        </div>
      </div>

      <!-- Pronunciation Lab -->
      <div class="card" id="pronLab" aria-labelledby="pronLabH">
        <h4 id="pronLabH">Pronunciation Lab (TTS)</h4>
        <p class="muted">Tap a sound to hear it and see examples.</p>
        <div class="grid" style="grid-template-columns:repeat(auto-fill,minmax(72px,1fr));gap:8px"></div>
        <div id="pronOut" class="muted" style="margin-top:8px"></div>
        <div class="actions" style="margin-top:8px">
          <button id="pronPractice" class="btn" type="button" disabled>Practice examples</button>
          <button id="pronStop" class="btn" type="button" disabled>Stop</button>
        </div>
      </div>
    </div>

    <!-- 3) Word ladders & morphology -->
    <div class="card" id="sec-ladders">
      <h3>3) Word ladders &amp; light morphology</h3>
      <p class="muted"><strong>Why it helps:</strong> small changes sharpen attention to patterns and ‚Äúmeaning chunks.‚Äù</p>

      <div class="grid-3-cols">
        <div class="tile">
          <h4>Letter change ladders</h4>
          <ul>
            <li><em>cat ‚Üí cot ‚Üí coat ‚Üí coast ‚Üí toast ‚Üí boast</em></li>
            <li><em>pin ‚Üí pan ‚Üí pain ‚Üí plain ‚Üí plane</em></li>
            <li><em>hop ‚Üí hope ‚Üí hose ‚Üí those</em></li>
            <li><em>light ‚Üí right ‚Üí fright ‚Üí bright</em></li>
          </ul>
        </div>
        <div class="tile">
          <h4>Prefixes / suffixes</h4>
          <ul>
            <li>Base <em>help</em> ‚Üí <em>rehelp, helpful, helpless, unhelpful</em></li>
            <li>Base <em>move</em> ‚Üí <em>remove, improve, movement</em></li>
            <li>Base <em>use</em> ‚Üí <em>reuse, useful, useless</em></li>
            <li>Base <em>clear</em> ‚Üí <em>unclear, clarify, clearly</em></li>
          </ul>
        </div>
      </div>

      <!-- Voice Coach ‚Äî Ladders & Affixes -->
      <div id="vcLadder" class="card" aria-labelledby="vcLadderH">
        <h4 id="vcLadderH">Voice Coach ‚Äî Ladders &amp; Affixes</h4>
        <div class="grid-3-cols">
          <div class="tile">
            <label for="ladderPick">Ladder set</label>
            <select id="ladderPick" title="Select option">
              <option value="cat" selected>cat ‚Üí cot ‚Üí coat ‚Üí coast ‚Üí toast ‚Üí boast</option>
              <option value="pin">pin ‚Üí pan ‚Üí pain ‚Üí plain ‚Üí plane</option>
              <option value="hop">hop ‚Üí hope ‚Üí hose ‚Üí those</option>
              <option value="light">light ‚Üí right ‚Üí fright ‚Üí bright</option>
            </select>
          </div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="ladderPlay" class="btn btn-success" type="button">Play ladder</button>
              <button id="ladderStop" class="btn" type="button" disabled>Stop</button>
            </div>
          </div>
        </div>

        <div class="grid-3-cols" style="margin-top:8px">
          <div class="tile"><label for="morphBase">Base word</label><input id="morphBase" type="text" value="help" title="Input" placeholder=" "></div>
          <div class="tile"><label for="morphAff">Affixes (comma-separated)</label><input id="morphAff" type="text" value="re-, un-, -ful, -less" title="Input" placeholder=" "></div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="morphPlay" class="btn btn-success" type="button">Play affixes</button>
              <button id="morphStop" class="btn" type="button" disabled>Stop</button>
            </div>
          </div>
        </div>
        <div id="vcLadderOut" class="muted" style="margin-top:6px"></div>
      </div>
    </div>

    <!-- Advanced training -->
    <div class="card" id="sec-advanced">
      <h2>Advanced Training: Comprehension, Memory &amp; Focus</h2>
      <div class="card">
        <h4>Active Comprehension: Creating mental movies</h4>
        <ol>
          <li><strong>Read and pause:</strong> two or three sentences, then stop.</li>
          <li><strong>Visualise:</strong> what did you see/hear/smell/feel? Name details.</li>
          <li><strong>Verbalise:</strong> say the image out loud to anchor it.</li>
          <li><strong>Connect:</strong> link the next bit to your last image.</li>
        </ol>
      </div>
      <div class="card">
        <h4>Memory &amp; Focus tools</h4>
        <div class="grid-2-cols">
          <div class="tile">
            <h5>Working memory: Chunking</h5>
            <p>Group information into manageable chunks to aid retention.</p>
            <button class="btn" id="btnChunkDrill" type="button">Start Chunking Drill (In-App)</button>
          </div>
          <div class="tile">
            <h5>Sustained focus: Visual Pomodoro</h5>
            <p>Focused bursts with short breaks to avoid fatigue.</p>
            <button class="btn" id="btnFocusTimer" type="button">Open Visual Focus Timer</button>
          </div>
        </div>
      </div>
    </div>

    <!-- M Share App Tools (fixed contrast & functionality) -->
    <div class="card card-brand-mshare" id="sec-mshare-app">
      <h2 style="color:var(--btn-bg);">M Share App Tools</h2>

      <!-- TTS Controller -->
      <div class="card" id="ttsPanel" aria-labelledby="ttsPanelH">
        <h4 id="ttsPanelH">Text-to-Speech with Tracking</h4>
        <div class="grid-3-cols" style="align-items:end">
          <div class="tile">
            <label for="ttsSel">Voice</label>
            <select id="ttsSel">
              <option value="uk-m" selected>Daniel (en-GB)</option>
              <option value="uk-f">British Female</option>
              <option value="uk-auto">Auto (best UK)</option>
              <option value="system">System Default</option>
            </select>
          </div>
          <div class="tile">
            <label for="ttsRate">Rate</label>
            <input id="ttsRate" type="range" min="0.7" max="1.5" step="0.05" value="1.0">
          </div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="ttsStart" class="btn btn-success" type="button">üéß Start</button>
              <button id="ttsStop" class="btn" type="button" disabled>‚ñ† Stop</button>
            </div>
          </div>
        </div>
        <textarea id="ttsText" rows="3" style="margin-top:10px">The quick brown fox jumps over the lazy dog. Reading with a consistent pace reduces regression and builds fluency.</textarea>
        <div id="ttsOut" class="muted" style="margin-top:6px">Ready.</div>
      </div>

      <!-- Focus Filter & Writer (descriptions retained) -->
      <div class="grid-3-cols">
        <div class="tile"><h5>Focus Filter Mode</h5><p>Applies a soft colour overlay; some readers find this steadies text.</p></div>
        <div class="tile"><h5>Text-to-Speech with tracking</h5><p>Reads aloud while highlighting the current word.</p></div>
        <div class="tile"><h5>Distraction-Free Writer</h5><p>Minimal interface to keep writing flow.</p></div>
      </div>

      <!-- Multi-modal paced reading -->
      <h4 id="mshareTrainerTitle">‚û°Ô∏è M Share Trainer: Multi-modal paced reading</h4>
      <div class="card">
        <div class="grid-3-cols" style="align-items:end">
          <div class="tile">
            <label for="trainerText">Reading text (short)</label>
            <textarea id="trainerText" rows="3">The quick brown fox jumps over the lazy dog. Reading with a consistent pace reduces regression and builds fluency.</textarea>
          </div>
          <div class="tile">
            <label for="trainerPace">Speed (WPM)</label>
            <input id="trainerPace" type="number" value="120" min="60" max="400">
          </div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="startTrainer" class="btn btn-success" type="button">‚ñ∂Ô∏è Start Paced Reading</button>
              <button id="stopTrainer" class="btn" type="button" disabled>‚èπ Stop Trainer</button>
            </div>
          </div>
        </div>
        <div id="trainerDisplay" aria-live="polite"
             style="margin-top:15px;padding:10px;border:1px solid var(--b);min-height:80px;border-radius:8px;background:#f0f4f8;font-size:1.1em;">
          <p class="muted">Trainer will display text here, highlighting words at the chosen pace.</p>
        </div>
      </div>
    </div>

    <!-- 4) General reading speed training -->
    <div class="card dlx-standard-text" id="sec-speedread">
      <h2>General Reading Speed Training (for everyone)</h2>
      <h4>The Pointer Method: Smooth pacing</h4>
      <p>Use a finger/pen/stylus to steadily underline text as you read.</p>
      <div class="actions"><button class="btn" id="btnOpenPacer" type="button">Start Digital Pacer Tool</button></div>
    </div>

    <!-- 5) Fluency lines with pacer -->
    <div class="card" id="sec-fluency">
      <h3>5) Fluency lines</h3>
      <p class="muted"><strong>Why it helps:</strong> repeated, smooth reading grows automaticity without pushing speed.</p>
      <ul>
        <li>Pick 2‚Äì3 short lines at the right level. Re-read for <em>smoothness</em>, not speed.</li>
        <li>Use a finger, ruler, or overlay as a pacer.</li>
      </ul>

      <!-- FLUENCY PACER -->
      <div id="pacer" class="card" aria-labelledby="pacerH">
        <h4 id="pacerH">Fluency Pacer</h4>
        <p class="muted">Reveals words at a set pace. Aim for smooth, low-effort reading.</p>

        <textarea id="pText" rows="4" title="Reading practice text"
          placeholder="Enter text to practice reading here">Today I will read in a calm, steady voice. I let each breath guide my pace. I notice patterns in words and turn them into easy steps. Small wins add up.</textarea>

        <div class="grid-3-cols" style="margin-top:8px">
          <div class="tile">
            <label for="pSamples">Load sample</label>
            <select id="pSamples" title="Select option">
              <option value="custom" selected>‚Äî My text above ‚Äî</option>
              <option value="affirm">Affirmations (calm focus)</option>
              <option value="story">Short story lines</option>
              <option value="work">Work email snippet</option>
            </select>
          </div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="pPaste" class="btn" type="button">Paste from clipboard</button>
              <label class="btn">Import .txt<input id="pImport" type="file" accept=".txt" style="display:none" title="Input"></label>
              <button id="pExport" class="btn" type="button">Export .txt</button>
            </div>
          </div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions"><button id="pClear" class="btn" type="button">Clear text</button></div>
          </div>
        </div>

        <div class="grid-3-cols" style="margin-top:8px">
          <div class="tile"><label for="wpm">Words per minute</label><input id="wpm" type="number" min="40" max="300" value="110" title="Input"></div>
          <div class="tile"><label for="pChunk">Words per tick</label><input id="pChunk" type="number" min="1" max="5" value="1" title="Input"></div>
          <div class="tile"><label for="pMode">Mode</label>
            <select id="pMode" title="Select option">
              <option value="highlight" selected>Highlight next words</option>
              <option value="mask">Mask rest of text</option>
            </select>
          </div>
        </div>

        <div class="grid-3-cols" style="margin-top:8px">
          <div class="tile"><label for="pFont">Font size <span class="muted" id="pFontVal">18px</span></label><input id="pFont" type="range" min="14" max="36" value="18" title="Input"></div>
          <div class="tile"><label for="pLine">Line height <span class="muted" id="pLineVal">1.50</span></label><input id="pLine" type="range" min="1.2" max="2.0" step="0.05" value="1.5" title="Input"></div>
          <div class="tile"><label for="pLet">Letter spacing <span class="muted" id="pLetVal">0.04em</span></label><input id="pLet" type="range" min="0" max="0.16" step="0.01" value="0.04" title="Input"></div>
        </div>

        <div class="grid-3-cols" style="margin-top:8px">
          <div class="tile"><label for="pOverlay">Overlay tint</label>
            <select id="pOverlay" title="Select option">
              <option value="none" selected>None</option>
              <option value="yellow">Soft Yellow</option>
              <option value="blue">Soft Blue</option>
              <option value="grey">Soft Grey</option>
            </select>
          </div>
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions" style="align-items:center">
              <label class="btn" style="display:flex;align-items:center;gap:8px"><input id="pBeep" type="checkbox"> Metronome tick</label>
              <label class="btn" style="display:flex;align-items:center;gap:8px"><input id="pCount" type="checkbox"> Count-in 3-2-1</label>
              <label class="btn" style="display:flex;align-items:center;gap:8px"><input id="pFull" type="checkbox"> Fullscreen</label>
            </div>
          </div>
          <div class="tile"><label class="muted">Timing</label>
            <div id="pTiming" class="muted">Interval: ‚Äî ms ‚Ä¢ Chunk: 1</div>
          </div>
        </div>

        <div class="grid-3-cols" style="margin-top:8px">
          <div class="tile">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="pStart" class="btn btn-success" type="button">Start</button>
              <button id="pPause" class="btn" type="button" disabled>Pause</button>
              <button id="pStop" class="btn" type="button" disabled>Stop</button>
            </div>
            <p class="muted" style="margin:.4rem 0 0">Shortcuts: <kbd>Space</kbd> Pause/Resume ‚Ä¢ <kbd>Esc</kbd> Stop ‚Ä¢ <kbd>¬±</kbd> WPM ‚Ä¢ <kbd>[ / ]</kbd> Chunk</p>
          </div>
          <div class="tile">
            <label class="muted">Status</label>
            <div id="pStat" class="muted" aria-live="polite">Idle</div>
            <div id="pMeta"></div>
          </div>
        </div>

        <div id="pOutWrap" style="margin-top:8px;position:relative">
          <div id="pCountOverlay" style="position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);border-radius:10px;z-index:5">
            <div style="font-size:72px;font-weight:800;color:white;letter-spacing:.02em">3</div>
          </div>
          <div id="pOut" style="min-height:72px;border:1px solid var(--b);border-radius:10px;padding:12px;font-size:18px;line-height:1.5;letter-spacing:.04em">
            <span class="pacer-muted">Press <strong>Start</strong> to begin.</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 6) RAN -->
    <div class="card" id="sec-ran">
      <h3>6) Rapid naming (RAN) micro-drill</h3>
      <p class="muted"><strong>Why it helps:</strong> quicker naming of known items supports fluent decoding.</p>
      <ul><li>Say highlighted items row by row. Keep voice relaxed; take one breath between rows.</li></ul>

      <div id="ran" class="card" aria-labelledby="ranH">
        <h4 id="ranH">Rapid Naming Strip</h4>
        <div class="grid-3-cols">
          <div class="tile"><label for="ranSet">Symbols/letters (5 items)</label><input id="ranSet" type="text" value="a, s, 3, @, k" title="Input"></div>
          <div class="tile"><label for="ranSpeed">Speed (items/sec)</label><input id="ranSpeed" type="number" min="0.5" max="5" step="0.1" value="1.5" title="Input"></div>
          <div class="tile"><label for="ranRows">Rows</label><select id="ranRows" title="Select option"><option>3</option><option selected>4</option><option>5</option></select></div>
        </div>
        <div class="actions" style="margin-top:8px">
          <button id="ranGo" class="btn btn-success" type="button">Start</button>
          <button id="ranStop" class="btn" type="button" disabled>Stop</button>
          <span id="ranStat" class="muted" aria-live="polite" style="margin-left:8px">Items: 0 ‚Ä¢ Best: ‚Äî</span>
        </div>
        <div id="ranGrid" style="display:grid;gap:6px;margin-top:10px"></div>
      </div>
    </div>

    <!-- Resources -->
    <h2>Resources (Adults)</h2>
    <div class="card">
      <ul>
        <li><a href="https://www.twinkl.com.sg/search?q=dyslexia+resources+adult&amp;c=244&amp;r=parent&amp;fco=0&amp;n=30&amp;fa=9" target="_blank" rel="noopener">Twinkl ‚Äì adult dyslexia resources</a></li>
        <li><a href="https://www.bdadyslexia.org.uk/advice/adults" target="_blank" rel="noopener">British Dyslexia Association ‚Äì Adults</a></li>
        <li><a href="https://dyslexiaida.org/" target="_blank" rel="noopener">International Dyslexia Association</a></li>
        <li><a href="https://dyslexia.yale.edu/resources/adults/" target="_blank" rel="noopener">Yale Center for Dyslexia &amp; Creativity ‚Äì Adults</a></li>
        <li><a href="https://www.understood.org/en/articles/dyslexia-in-adults" target="_blank" rel="noopener">Understood.org ‚Äì Dyslexia in adults</a></li>
        <li><a href="https://improvingliteracy.org/" target="_blank" rel="noopener">National Center on Improving Literacy</a></li>
        <li><a href="https://readingrockets.org/" target="_blank" rel="noopener">Reading Rockets</a></li>
        <li><a href="https://www.nidcd.nih.gov/health/voice-speech-and-language" target="_blank" rel="noopener">NIH / NIDCD</a></li>
        <li><a href="https://www.dyslexia-scotland.org.uk/adults/" target="_blank" rel="noopener">Dyslexia Scotland ‚Äì Adults</a></li>
      </ul>
      <div class="actions" style="margin-top:10px">
        <button id="downloadResourcesPdf" class="btn btn-success" type="button">Download: Dyslexia Adult Resources (PDF)</button>
      </div>
    </div>

    <div class="card">
      <h3>Download PDFs</h3>
      <div class="row-actions" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
        <a class="btn" href="https://files.mindpaylink.com/pdfs%3Adyslexia-adult-resources-uk.pdf" download>‚¨á Adult Resources (PDF)</a>
        <a class="btn" href="https://files.mindpaylink.com/pdfs%3Adyslexia-parent-support-guide.pdf" download>‚¨á Parent Guide (PDF)</a>
        <a class="btn" href="https://files.mindpaylink.com/pdfs%3Adyslexia-practice-pack-templates.pdf" download>‚¨á Practice Pack (PDF)</a>
      </div>
    </div>

    <hr />
    <p class="muted">¬© <span id="year"></span> ‚Äî Educational information only; not medical advice.</p>
  </main>

  <!-- Minimal modal (for small notices) -->
  <div id="focusModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:9999;padding:16px" aria-live="polite" aria-modal="true" role="dialog">
    <div id="focusModalCard" class="card" style="max-width:720px;width:min(96vw,720px)">
      <h3 id="fmTitle" style="margin-top:0">Reading Trainer</h3>
      <div id="fmBody" class="muted" style="margin-top:6px"></div>
      <div class="actions" style="margin-top:10px">
        <button id="fmOk" class="btn btn-success" type="button">OK</button>
        <button id="fmCancel" class="btn" type="button" style="display:none">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Visual Pomodoro micro-bar -->
  <div id="pomoBar" style="position:fixed;right:12px;bottom:12px;display:none;z-index:9998;max-width:90vw">
    <div class="card" style="padding:10px 12px">
      <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
        <strong id="pomoLabel">Focus</strong>
        <span id="pomoTime" class="muted">00:00</span>
        <div class="actions" style="margin-left:auto">
          <button id="pomoSkip" class="btn" type="button">Skip break</button>
          <button id="pomoEnd" class="btn" type="button">End</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Core utilities & Focus Screen JS (separate file + inline fallback) ===== -->
  <script src="assets/js/focus-screen.js" defer></script>
  <script id="focus-screen-js-inline">
    (function(){
      // Brand button colour auto-mapping
      function mapBtnColours(){
        try{
          const probe=document.querySelector('.btn');
          if(!probe)return;
          const cs=getComputedStyle(probe);
          document.documentElement.style.setProperty('--btn-bg', cs.backgroundColor || '#0ea5e9');
          document.documentElement.style.setProperty('--btn-fg', cs.color || '#ffffff');
        }catch(e){}
        // Success/danger: find first .btn.btn-success/.btn.btn-danger in DOM or fallback
        try{
          const ok=document.querySelector('.btn.btn-success');
          if(ok){const cs=getComputedStyle(ok);document.documentElement.style.setProperty('--btn-success-bg', cs.backgroundColor||'#22c55e')}
          const dn=document.querySelector('.btn.btn-danger');
          if(dn){const cs=getComputedStyle(dn);document.documentElement.style.setProperty('--btn-danger-bg', cs.backgroundColor||'#ef4444')}
        }catch(e){}
      }

      // Focus Screen module
      const FS=(function(){
        const wrap=document.getElementById('focusScreen');
        const title=document.getElementById('fsTitle');
        const tool=document.getElementById('fsTool');
        const note=document.getElementById('fsNote');
        const timer=document.getElementById('fsTimer');
        const slot=document.getElementById('fsSlot');
        const btnPause=document.getElementById('fsPause');
        const btnResume=document.getElementById('fsResume');
        const btnEnd=document.getElementById('fsEnd');
        let ticking=null, startedAt=0, paused=false, pauseAcc=0, onEnd=null, onPauseHook=null, onResumeHook=null;

        function fmt(ms){const s=Math.max(0,Math.floor(ms/1000));const mm=String((s/60)|0).padStart(2,'0');const ss=String(s%60).padStart(2,'0');return mm+':'+ss}
        function paint(){if(!startedAt){timer.textContent='00:00';return}
          const now=performance.now();
          const eff=(paused?pauseAcc:(now-startedAt-pauseAcc));
          timer.textContent=fmt(eff);
        }
        function startTick(){stopTick(); ticking=setInterval(paint,250)}
        function stopTick(){if(ticking){clearInterval(ticking);ticking=null}}

        btnPause.addEventListener('click',()=>{ if(paused)return; paused=true; pauseAcc=performance.now()-startedAt-pauseAcc; btnPause.style.display='none'; btnResume.style.display='inline-flex'; onPauseHook&&onPauseHook(); });
        btnResume.addEventListener('click',()=>{ if(!paused)return; paused=false; btnPause.style.display='inline-flex'; btnResume.style.display='none'; onResumeHook&&onResumeHook(); });
        btnEnd.addEventListener('click',()=>{ FS.close(); onEnd&&onEnd(); });

        return {
          open(opts){
            title.textContent=opts.title||'Training';
            tool.textContent=opts.tool||'‚Äî';
            note.textContent=opts.note||'Keep it calm and steady.';
            slot.innerHTML='';
            if(opts.mount){ slot.appendChild(opts.mount) }
            startedAt=performance.now(); paused=false; pauseAcc=0; paint(); startTick();
            onEnd=opts.onEnd||null; onPauseHook=opts.onPause||null; onResumeHook=opts.onResume||null;
            wrap.setAttribute('aria-hidden','false');
          },
          close(){ stopTick(); wrap.setAttribute('aria-hidden','true'); slot.innerHTML=''; startedAt=0; paused=false; pauseAcc=0; btnPause.style.display='inline-flex'; btnResume.style.display='none'; }
        };
      })();

      // Minimal modal helper (used in minor cues)
      const Modal=(function(){
        const wrap=document.getElementById('focusModal');
        const title=document.getElementById('fmTitle');
        const body=document.getElementById('fmBody');
        const ok=document.getElementById('fmOk');
        const cancel=document.getElementById('fmCancel');
        let onOk=null,onCancel=null;
        ok.addEventListener('click',()=>{wrap.style.display='none';onOk&&onOk();onOk=onCancel=null});
        cancel.addEventListener('click',()=>{wrap.style.display='none';onCancel&&onCancel();onOk=onCancel=null});
        return {show(o){title.textContent=o.title||'Notice';body.innerHTML=o.html||'';ok.textContent=o.okText||'OK';cancel.style.display=o.cancelText?'':'none';if(o.cancelText)cancel.textContent=o.cancelText;onOk=o.onOk||null;onCancel=o.onCancel||null;wrap.style.display='flex'}};
      })();

      // Pomo micro (work/break timer that the Focus Screen reads)
      const Pomo=(function(){
        const bar=document.getElementById('pomoBar');
        const label=document.getElementById('pomoLabel');
        const time=document.getElementById('pomoTime');
        const btnSkip=document.getElementById('pomoSkip');
        const btnEnd=document.getElementById('pomoEnd');
        let mode='work',remain=0,timer=null,cfg={work:120,break:30};
        function fmt(s){s=Math.max(0,s|0);const m=String((s/60)|0).padStart(2,'0');const ss=String(s%60).padStart(2,'0');return m+':'+ss}
        function tick(){time.textContent=fmt(remain); if(remain<=0){ if(mode==='work'){mode='break';label.textContent='Break';remain=cfg.break;Modal.show({title:'Break time',html:'<p>Rest eyes and shoulders for <strong>'+cfg.break+'s</strong>. Try 1 round of <em>4-7-8</em> breathing.</p>',okText:'Resume'})} else {mode='work';label.textContent='Focus';remain=cfg.work} } else remain--}
        btnSkip.addEventListener('click',()=>{if(mode==='break'){mode='work';label.textContent='Focus';remain=cfg.work}});
        btnEnd.addEventListener('click',()=>{Pomo.stop()});
        return { start(o){cfg=Object.assign({work:120,break:30},o||{});mode='work';remain=cfg.work;label.textContent='Focus';bar.style.display='block';clearInterval(timer);timer=setInterval(tick,1000)},
                 stop(){bar.style.display='none';clearInterval(timer)} };
      })();

      // Global TTS with sanitiser
      (function(){
        const PREF='mshare_tts_pref_v1';
        function getPref(){return localStorage.getItem(PREF)||'uk-m'}
        function setPref(v){localStorage.setItem(PREF,v)}
        function score(v,want){let s=0;const name=(v.name||'').toLowerCase(), lang=(v.lang||'').toLowerCase();
          if(lang.startsWith('en-gb'))s+=100; if(want==='uk-m'&&name.includes('male'))s+=40; if(want==='uk-f'&&name.includes('female'))s+=40;
          if(name.includes('google uk english'))s+=60; if(name.includes('google'))s+=8; if(name.includes('microsoft'))s+=6; return s}
        function pick(want){const list=speechSynthesis.getVoices()||[]; if(!list.length) return null; if(want==='system')return list[0]; let best=null,sc=-1; list.forEach(v=>{const ss=score(v,want); if(ss>sc){best=v;sc=ss}}); return best||list[0]}
        function sanitize(t){try{let x=String(t||''); x=x.replace(/\//g,' or ').replace(/[^A-Za-z' -]+/g,' ').replace(/\s{2,}/g,' ').trim(); return x}catch(e){return String(t||'')}}
        function speak(text, rate){
          if(!('speechSynthesis' in window))return;
          const clean=sanitize(text); if(!clean)return;
          const u=new SpeechSynthesisUtterance(clean);
          try{const want=(window.__MSHARE__&&__MSHARE__.TTS_WANT)||getPref(); const v=pick(want); if(v)u.voice=v}catch(e){}
          if(rate)u.rate=rate;
          try{speechSynthesis.cancel()}catch(e){}
          speechSynthesis.speak(u);
        }
        window.__MSHARE__=window.__MSHARE__||{};
        window.__MSHARE__.TTS={speak,sanitize,setPref};
        try{speechSynthesis.onvoiceschanged=function(){}; speechSynthesis.getVoices()}catch(e){}
      })();

      // FocusScreen-aware begin/end hooks
      function beginTraining(toolId, sectionEl, startFn, opts){
        // mount a small live panel clone (if provided)
        let mount=null;
        if(opts && opts.mountSelector){
          const el=sectionEl.querySelector(opts.mountSelector);
          if(el){ mount=el.cloneNode(true); }
        }
        FS.open({
          title: opts&&opts.title || sectionEl.querySelector('h3,h4,h2')?.textContent || 'Training',
          tool: toolId,
          note: opts&&opts.note || 'Calm, steady pacing. Pause anytime.',
          mount,
          onEnd(){ try{Pomo.stop()}catch(e){}; FS.close(); try{Focus.exit()}catch(e){} },
          onPause(){ try{speechSynthesis.pause&&speechSynthesis.pause()}catch(e){} },
          onResume(){ try{speechSynthesis.resume&&speechSynthesis.resume()}catch(e){} }
        });
        // Keep the original section in view (background hidden by FS)
        try{sectionEl.scrollIntoView({behavior:'smooth',block:'start'})}catch(e){}
        try{Pomo.start({work:120,break:30})}catch(e){}
        startFn();
      }
      function endAndDyslexia(){ try{Pomo.stop()}catch(e){}; try{FS.close()}catch(e){} }

      // Expose utilities used elsewhere
      window.__MSHARE__=window.__MSHARE__||{};
      window.__MSHARE__.FocusScreen={open:FS.open,close:FS.close};
      window.__MSHARE__.Pomo=Pomo;
      window.__MSHARE__.beginTraining=beginTraining;
      window.__MSHARE__.endAndDyslexia=endAndDyslexia;
      window.addEventListener('DOMContentLoaded',mapBtnColours);
    })();
  </script>

  <!-- ===== Feature modules (Segment/Blend, Studio, PronLab, Search, Schulte, RAN, Pacer, Trainer, PDFs) ===== -->
  <script>
    // Short aliases
    const prefersReduce = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    // Quick utilities
    (function(){
      // Active link, footer year, back-to-top
      const path=(location.pathname.split("/").pop()||"index.html").toLowerCase();
      document.querySelectorAll('nav a[href]').forEach(a=>{if((a.getAttribute('href')||'').toLowerCase()===path)a.classList.add('active')});
      const y1=document.getElementById("year"); if(y1) y1.textContent=new Date().getFullYear();
      const up=document.getElementById("backToTop"); if(up) up.addEventListener("click",e=>{e.preventDefault(); try{(document.getElementById("top")||document.body).scrollIntoView({behavior:"smooth",block:"start"})}catch{location.hash="#top"}})
    })();

    // ===== Voice Coach ‚Äî Segment‚ÜíBlend
    (function(){
      const root=document.getElementById("vcPhon"); if(!root) return;
      const word=document.getElementById("vcWord");
      const pace=document.getElementById("vcPace");
      const play=document.getElementById("vcPlay");
      const stop=document.getElementById("vcStop");
      const out=document.getElementById("vcOut");
      let loop=null,t0=0;

      function paceMs(){return pace.value==="slow"?800:pace.value==="fast"?320:520}
      function start(){
        const w=(word.value||"").trim(); if(!w) return;
        window.__MSHARE__.beginTraining("vcSegment", root, ()=>{
          stop.disabled=false; play.disabled=true; out.textContent="Segmenting: "+w;
          const chars=w.split(""); let i=0; t0=performance.now();
          loop=setInterval(()=>{
            if(i<chars.length){ window.__MSHARE__.TTS.speak(chars[i],0.9); i++; }
            else if(i===chars.length){ window.__MSHARE__.TTS.speak(w,1.0); i++; }
            else{ clearInterval(loop); stop.disabled=true; play.disabled=false; window.__MSHARE__.endAndDyslexia(); }
          }, paceMs());
        }, {title:'Segment & Blend', note:'Listen to each sound, then the whole word.'});
      }
      function halt(){ clearInterval(loop); try{speechSynthesis.cancel()}catch(e){}; stop.disabled=true; play.disabled=false; window.__MSHARE__.endAndDyslexia() }
      play.addEventListener('click',start);
      stop.addEventListener('click',halt);
    })();

    // ===== Sound Training Studio
    (function(){
      const root=document.getElementById("svStudio"); if(!root) return;
      const sel=document.getElementById("svSelect"); const tiles=document.getElementById("svTiles");
      const out=document.getElementById("svOut"); const btnAll=document.getElementById("svPractice"); const btnStop=document.getElementById("svStop");
      const btnCam=document.getElementById("svCam"); const btnCamOff=document.getElementById("svCamOff"); const mirrorWrap=document.getElementById("svMirrorWrap"); const mirror=document.getElementById("svMirror");
      let loop=null, curSet=[], speakOn=("speechSynthesis" in window);

      const SETS={ short:[{g:"a",ex:["cat","map"]},{g:"e",ex:["bed","hem"]},{g:"i",ex:["sit","milk"]},{g:"o",ex:["hot","pond"]},{g:"u",ex:["sun","drum"]}],
                   long:[{g:"a",ex:["late","paper"]},{g:"e",ex:["tree","even"]},{g:"i",ex:["time","pilot"]},{g:"o",ex:["home","open"]},{g:"u",ex:["unit","music"]}],
                   digraphs:[{g:"sh",ex:["ship","brush"]},{g:"ch",ex:["chat","teacher"]},{g:"th",ex:["thin","this"]},{g:"ph",ex:["phone","graph"]},{g:"wh",ex:["when","whale"]},{g:"tch",ex:["catch","match"]},{g:"dge",ex:["bridge","edge"]},{g:"igh",ex:["high","night"]}],
                   teams:[{g:"ai/ay",ex:["rain","day"]},{g:"ee/ea",ex:["see","team"]},{g:"oa/ow",ex:["boat","snow"]},{g:"oi/oy",ex:["coin","boy"]},{g:"ou/ow",ex:["sound","cloud"]},{g:"au/aw",ex:["cause","saw"]}],
                   r:[{g:"ar",ex:["car","start"]},{g:"er/ir/ur",ex:["her","bird"]},{g:"or",ex:["fork","north"]}],
                   silent:[{g:"kn/gn",ex:["knee","gnome"]},{g:"wr",ex:["write","wrist"]},{g:"mb",ex:["thumb","comb"]},{g:"igh",ex:["light"]}] };

      function buildTiles(topic){
        tiles.innerHTML=""; out.textContent=speakOn?"Tap a tile to hear the sound and examples.":"Speech not available in this browser.";
        curSet=SETS[topic]||[];
        curSet.forEach(s=>{
          const b=document.createElement('button');
          b.className='btn'; b.type='button'; b.textContent=s.g; b.style.minWidth='84px';
          b.addEventListener('click',()=>window.__MSHARE__.beginTraining('soundStudio', root, ()=>{
            out.innerHTML="<strong>"+s.g+"</strong>: "+s.ex.join(", ");
            if(speakOn){ window.__MSHARE__.TTS.speak(s.g,.9); setTimeout(()=>s.ex.forEach((w,i)=>setTimeout(()=>window.__MSHARE__.TTS.speak(w,1),700*(i+1))),400) }
            btnAll.disabled=false; btnStop.disabled=false;
          }, {title:'Sound Training Studio', note:'Say the sound, then say example words.'}));
          tiles.appendChild(b);
        });
        btnAll.disabled=curSet.length===0; btnStop.disabled=true;
      }
      sel.addEventListener('change',()=>buildTiles(sel.value)); buildTiles(sel.value);

      btnAll.addEventListener('click',()=>window.__MSHARE__.beginTraining('soundStudio', root, ()=>{
        if(!("speechSynthesis" in window) || curSet.length===0) return;
        clearInterval(loop); let i=0;
        loop=setInterval(()=>{
          const s=curSet[i%curSet.length];
          out.innerHTML="<strong>"+s.g+"</strong>: "+s.ex.join(", ");
          try{speechSynthesis.cancel()}catch(e){}
          window.__MSHARE__.TTS.speak(s.g,.9);
          setTimeout(()=>window.__MSHARE__.TTS.speak(s.ex[0]||""),600);
          setTimeout(()=>window.__MSHARE__.TTS.speak(s.ex[1]||""),1100);
          i++;
        }, prefersReduce?2200:1800);
        btnStop.disabled=false;
      }, {title:'Sound Training Studio', note:'Cycle through all sounds in this set.'}));

      btnStop.addEventListener('click',()=>{clearInterval(loop); try{speechSynthesis.cancel()}catch(e){} btnStop.disabled=true; window.__MSHARE__.endAndDyslexia()});

      btnCam.addEventListener('click',()=>window.__MSHARE__.beginTraining('soundStudio', root, async ()=>{
        try{const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'},audio:false});
          mirror.srcObject=stream; mirrorWrap.style.display='block'; btnCamOff.disabled=false;
        }catch(e){out.textContent='Camera permission not granted.'}
      }, {title:'Mirror Mode', note:'Use the camera as a mirror to watch mouth shape.'}));

      btnCamOff.addEventListener('click',()=>{ if(mirror.srcObject) mirror.srcObject.getTracks().forEach(t=>t.stop()); mirror.srcObject=null; mirrorWrap.style.display='none'; btnCamOff.disabled=true; window.__MSHARE__.endAndDyslexia()});
    })();

    // ===== Pronunciation Lab
    (function(){
      const root=document.getElementById("pronLab"); if(!root) return;
      const btnWrap=root.querySelector(".grid"); const out=document.getElementById("pronOut");
      const btnPractice=document.getElementById("pronPractice"); const btnStop=document.getElementById("pronStop");
      const SETS=[{g:"a",ex:["apple","able"]},{g:"e",ex:["egg","even"]},{g:"i",ex:["ink","idea"]},{g:"o",ex:["odd","open"]},{g:"u",ex:["up","unit"]},{g:"sh",ex:["ship","brush"]},{g:"ch",ex:["chip","teacher"]},{g:"th",ex:["thin","this"]},{g:"ph",ex:["phone","graph"]},{g:"wh",ex:["when","whale"]},{g:"ai",ex:["rain","train"]},{g:"ee",ex:["seen","green"]},{g:"ea",ex:["team","leave"]},{g:"oa",ex:["boat","coast"]},{g:"ow",ex:["slow","grow"]},{g:"oi",ex:["coin","point"]},{g:"oy",ex:["boy","enjoy"]},{g:"ou",ex:["out","sound"]},{g:"aw",ex:["saw","dawn"]},{g:"au",ex:["cause","launch"]},{g:"ar",ex:["car","sharp"]},{g:"er",ex:["her","fern"]},{g:"ir",ex:["bird","shirt"]},{g:"or",ex:["for","storm"]},{g:"ur",ex:["turn","nurse"]},{g:"igh",ex:["high","night"]},{g:"tch",ex:["catch","match"]},{g:"dge",ex:["bridge","edge"]},{g:"kn",ex:["knock","knee"]},{g:"wr",ex:["write","wrap"]},{g:"mb",ex:["thumb","comb"]}];
      let current=null, loop=null, idx=0, t0=0;
      SETS.forEach(s=>{const b=document.createElement('button'); b.className='btn'; b.type='button'; b.textContent=s.g; b.style.minWidth='72px';
        b.addEventListener('click',()=>window.__MSHARE__.beginTraining('pronLab', root, ()=>{
          current=s; out.innerHTML="<strong>"+s.g+"</strong>: "+s.ex.join(", "); btnPractice.disabled=false; btnStop.disabled=false;
          window.__MSHARE__.TTS.speak(s.g,.8); setTimeout(()=>s.ex.forEach((w,i)=>setTimeout(()=>window.__MSHARE__.TTS.speak(w,1),700*(i+1))),500);
        }, {title:'Pronunciation Lab', note:'Tap a sound. Listen, then repeat.'}));
        btnWrap.appendChild(b);
      });
      btnPractice.addEventListener('click',()=>window.__MSHARE__.beginTraining('pronLab', root, ()=>{
        if(!current) return; if(loop) clearInterval(loop); idx=0; t0=performance.now();
        loop=setInterval(()=>{window.__MSHARE__.TTS.speak(current.ex[idx%current.ex.length],1); idx++},1200);
      }, {title:'Practice Examples', note:'Repeat aloud with relaxed breath.'}));
      btnStop.addEventListener('click',()=>{ if(loop) clearInterval(loop); try{speechSynthesis.cancel()}catch(e){} window.__MSHARE__.endAndDyslexia() });
    })();

    // ===== Letter / Number Search
    (function(){
      const card=document.getElementById("searchTool"); const grid=document.getElementById("sGrid"); if(!grid||!card)return;
      const targets=document.getElementById("targets"); const sizeSel=document.getElementById("size"); const mix=document.getElementById("mix");
      const info=document.getElementById("sInfo"); const start=document.getElementById("sStart"); const stopBtn=document.getElementById("sStop");
      const again=document.getElementById("sAgain"); const bestEl=document.getElementById("sBest");
      let targetSet=new Set(), remain=0, score=0, clicks=0, startTime=0, timer=null, running=false;
      function key(){return "mshare_search_best_"+sizeSel.value+"_"+(targets.value||"")+"_"+mix.value}
      function showBest(){const best=localStorage.getItem(key()); bestEl.textContent=best?"Best time: "+best+"s":""}
      function randChar(mode){const letters="abcdefghijklmnopqrstuvwxyz", digits="0123456789"; if(mode==="letters")return letters[Math.floor(Math.random()*letters.length)]; if(mode==="digits")return digits[Math.floor(Math.random()*digits.length)]; return Math.random()<0.7?letters[Math.floor(Math.random()*letters.length)]:digits[Math.floor(Math.random()*digits.length)]}
      function refresh(){const secs=Math.round((Date.now()-startTime)/1000); info.textContent="Score: "+score+" ‚Ä¢ Remaining: "+remain+" ‚Ä¢ Time: "+secs+"s ‚Ä¢ Clicks: "+clicks}
      function finish(byUser){ running=false; clearInterval(timer); Array.from(grid.children).forEach(c=>c.disabled=true); stopBtn.disabled=true; again.disabled=false;
        const secs=Math.round((Date.now()-startTime)/1000); if(remain===0){const b=parseInt(localStorage.getItem(key())||"9999",10); if(secs<b) localStorage.setItem(key(),String(secs)); showBest()} refresh(); if(byUser) window.__MSHARE__.endAndDyslexia(); }
      function build(){
        window.__MSHARE__.beginTraining("search", card, ()=>{
          grid.innerHTML=""; score=0; clicks=0; startTime=Date.now(); remain=0;
          targetSet=new Set(targets.value.split(",").map(s=>s.trim().toLowerCase()).filter(Boolean));
          const n=parseInt(sizeSel.value,10)||10; grid.style.gridTemplateColumns="repeat("+n+",1fr)";
          for(let i=0;i<n*n;i++){
            const ch=randChar(mix.value); const cell=document.createElement("button");
            cell.type="button"; cell.className="btn"; cell.textContent=ch; cell.style.padding="10px"; cell.style.fontWeight="700"; cell.style.minWidth="0";
            cell.dataset.hit=targetSet.has(ch)?"1":"0"; if(cell.dataset.hit==="1") remain++;
            cell.addEventListener("click",()=>{ if(!running||cell.disabled) return; clicks++; if(cell.dataset.hit==="1"){score++; remain--; cell.style.opacity=".45"} cell.disabled=true; refresh(); if(remain===0) finish(false); });
            grid.appendChild(cell);
          }
          again.disabled=true; stopBtn.disabled=false; running=true; clearInterval(timer); timer=setInterval(refresh,500); refresh(); showBest();
        }, {title:'Letter / Number Search', note:'Find all targets. Calm accuracy over speed.'});
      }
      start.addEventListener("click",build); again.addEventListener("click",build); stopBtn.addEventListener("click",()=>finish(true));
    })();

    // ===== Schulte Mini
    (function(){
      const card=document.getElementById("schulte"); const grid=document.getElementById("schGrid"); if(!grid||!card)return;
      const start=document.getElementById("schStart"); const stop=document.getElementById("schStop"); const stats=document.getElementById("schStats"); const BEST="mshare_schulte_best";
      let next=1,t0=0,running=false,rafId=null;
      function tick(){ if(!running) return; const s=((performance.now()-t0)/1000).toFixed(1); const best=localStorage.getItem(BEST)||"‚Äî"; stats.textContent="Time: "+s+"s ‚Ä¢ Best: "+best+" ‚Ä¢ "+(next-1)+"/25"; rafId=requestAnimationFrame(tick) }
      function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]} return a}
      function stopRun(finalize,byUser){ if(!running) return; running=false; cancelAnimationFrame(rafId); Array.from(grid.children).forEach(b=>b.disabled=true);
        const elapsed=(performance.now()-t0)/1000; if(finalize){ const time=elapsed.toFixed(1); const best=parseFloat(localStorage.getItem(BEST)||"9999"); if(next===26 && parseFloat(time)<best) localStorage.setItem(BEST,time); const showBest=localStorage.getItem(BEST)||"‚Äî"; stats.textContent="Time: "+time+"s ‚Ä¢ Best: "+showBest+" ‚Ä¢ "+(next-1)+"/25"; }
        if(byUser) window.__MSHARE__.endAndDyslexia(); stop.disabled=true;
      }
      function build(){
        window.__MSHARE__.beginTraining("schulte", card, ()=>{
          grid.innerHTML=""; next=1; running=true; t0=performance.now(); cancelAnimationFrame(rafId); tick(); stop.disabled=false;
          const arr=shuffle(Array.from({length:25},(_,i)=>i+1));
          arr.forEach(n=>{const b=document.createElement("button"); b.className="btn"; b.type="button"; b.textContent=n; b.style.padding="14px"; b.style.fontWeight="800";
            b.addEventListener("click",()=>{ if(!running) return; if(n===next){ b.style.opacity=".5"; b.disabled=true; next++; if(next===26) stopRun(true,false); }});
            grid.appendChild(b);
          });
        }, {title:'Schulte Mini', note:'Tap numbers 1‚Üí25 in order.'});
      }
      start.addEventListener("click",build); stop.addEventListener("click",()=>stopRun(true,true));
    })();

    // ===== RAN Strip
    (function(){
      const root=document.getElementById("ran"); if(!root) return;
      const ranSet=document.getElementById("ranSet"); const speed=document.getElementById("ranSpeed"); const rows=document.getElementById("ranRows");
      const go=document.getElementById("ranGo"); const stop=document.getElementById("ranStop"); const wrap=document.getElementById("ranGrid"); const stat=document.getElementById("ranStat");
      const BEST="mshare_ran_best_count"; let timer=null, order=[], ptr=0, count=0, t0=0;
      function bestText(){const b=localStorage.getItem(BEST); return b?(" ‚Ä¢ Best: "+b):" ‚Ä¢ Best: ‚Äî"}
      function buildGrid(){ wrap.innerHTML=""; const items=ranSet.value.split(",").map(s=>s.trim()).filter(Boolean); const c=5,r=parseInt(rows.value,10)||4; wrap.style.gridTemplateColumns="repeat("+c+",1fr)";
        for(let i=0;i<c*r;i++){const b=document.createElement("button"); b.className="btn"; b.type="button"; b.textContent=items[i%items.length]; b.style.padding="12px"; b.style.fontWeight="700"; b.disabled=true; wrap.appendChild(b)}}
      function start(){
        window.__MSHARE__.beginTraining("ran", root, ()=>{
          buildGrid(); const cells=Array.from(wrap.children); order=Array.from({length:cells.length},(_,i)=>i).sort(()=>Math.random()-.5);
          ptr=0; count=0; t0=performance.now(); stop.disabled=false; go.disabled=true; stat.textContent="Items: 0"+bestText();
          const interval=1000/parseFloat(speed.value||1.5);
          timer=setInterval(()=>{ cells.forEach(c=>c.style.outline="none"); const idx=order[ptr%order.length]; const cell=cells[idx]; cell.style.outline="3px solid var(--b)"; ptr++; count++; stat.textContent="Items: "+count+bestText(); }, prefersReduce?interval*1.5:interval);
        }, {title:'Rapid Naming', note:'Name highlighted items row by row.'});
      }
      function halt(){ clearInterval(timer); go.disabled=false; stop.disabled=true; Array.from(wrap.children).forEach(c=>c.style.outline="none");
        const b=parseInt(localStorage.getItem(BEST)||"0",10); if(count>b) localStorage.setItem(BEST,String(count)); stat.textContent="Items: "+count+bestText(); window.__MSHARE__.endAndDyslexia();}
      go.addEventListener('click',start); stop.addEventListener('click',halt); buildGrid(); stat.textContent="Items: 0"+bestText();
    })();

    // ===== Pacer (unchanged API, now FS-enabled through beginTraining)
    (function(){
      const card=document.getElementById("pacer"); const pText=document.getElementById("pText"); if(!pText||!card)return;
      const wpm=document.getElementById("wpm"); const chunkInp=document.getElementById("pChunk"); const modeSel=document.getElementById("pMode");
      const fontRange=document.getElementById("pFont"); const fontVal=document.getElementById("pFontVal"); const lineRange=document.getElementById("pLine"); const lineVal=document.getElementById("pLineVal");
      const letRange=document.getElementById("pLet"); const letVal=document.getElementById("pLetVal"); const overlaySel=document.getElementById("pOverlay");
      const beepChk=document.getElementById("pBeep"); const countChk=document.getElementById("pCount"); const fullChk=document.getElementById("pFull");
      const timingEl=document.getElementById("pTiming"); const pSamples=document.getElementById("pSamples"); const pPaste=document.getElementById("pPaste");
      const pImport=document.getElementById("pImport"); const pExport=document.getElementById("pExport"); const pClear=document.getElementById("pClear");
      const startBtn=document.getElementById("pStart"); const pauseBtn=document.getElementById("pPause"); const stopBtn=document.getElementById("pStop");
      const out=document.getElementById("pOut"); const outWrap=document.getElementById("pOutWrap"); const overlay=document.getElementById("pCountOverlay");
      const stat=document.getElementById("pStat"); const meta=document.getElementById("pMeta");
      let words=[], idx=0, chunk=1, tickTimer=null, t0=0, paused=false, audioCtx=null, pausedAt=0;
      const overlayMap={none:'transparent',yellow:'rgba(255,237,166,.22)',blue:'rgba(166,206,255,.22)',grey:'rgba(200,200,200,.12)'};
      function esc(s){return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
      function clamp(n,a,b){n=Number(n);if(isNaN(n))n=a; return Math.min(b,Math.max(a,n))}
      function intervalMs(){const w=clamp(parseInt(wpm.value||110,10),40,300); const c=clamp(parseInt(chunkInp.value||1,10),1,5); return Math.round((60000*c)/w)}
      function applyStyles(){ out.style.fontSize=fontRange.value+'px'; out.style.lineHeight=parseFloat(lineRange.value).toFixed(2); out.style.letterSpacing=parseFloat(letRange.value).toFixed(2)+'em'; out.style.background=overlayMap[overlaySel.value]||'transparent'; out.classList.toggle('pacer-masked',modeSel.value==='mask'); fontVal.textContent=fontRange.value+'px'; lineVal.textContent=parseFloat(lineRange.value).toFixed(2); letVal.textContent=parseFloat(letRange.value).toFixed(2)+'em'; timingEl.textContent='Interval: '+intervalMs()+' ms ‚Ä¢ Chunk: '+clamp(chunkInp.value,1,5)}
      function beep(){ if(!beepChk.checked) return; try{ audioCtx=audioCtx||new (window.AudioContext||window.webkitAudioContext)(); const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type='sine'; o.frequency.value=880; g.gain.value=0.0001; o.connect(g); g.connect(audioCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.08,audioCtx.currentTime+0.01); g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.09); o.stop(audioCtx.currentTime+0.1);}catch(e){}}
      function fmtTime(ms){const t=Math.max(0,Math.round(ms/1000)); const m=String((t/60)|0).padStart(2,'0'); const s=String(t%60).padStart(2,'0'); return m+':'+s}
      function render(){ const start=idx, end=Math.min(words.length, idx+chunk); const prev=words.slice(0,start).join(' '), curr=words.slice(start,end).join(' '), rest=words.slice(end).join(' ');
        out.innerHTML=`<span class="pacer-prev">${esc(prev)}</span> <span class="pacer-current">${esc(curr)}</span> <span class="pacer-muted">${esc(rest)}</span>`;
        const elapsed=tickTimer?(performance.now()-t0-pausedAt):0; const shown=Math.min(start,words.length); const mins=Math.max(0,elapsed/60000); const liveWpm=mins>0?(shown/mins):0; meta.textContent=`${shown}/${words.length} words ‚Ä¢ ${fmtTime(elapsed)} ‚Ä¢ ${Math.round(liveWpm)} wpm`;
      }
      function countInThen(fn){ if(!document.getElementById('pCount').checked){fn();return}
        overlay.style.display='flex'; const num=overlay.querySelector('div'); let n=3; num.textContent=n;
        const iv=setInterval(()=>{n--; if(n>0){num.textContent=n}else{clearInterval(iv); overlay.style.display='none'; fn()}}, prefersReduce?500:800);
      }
      function start(){
        window.__MSHARE__.beginTraining("pacer", card, ()=>{
          words=(pText.value||'').replace(/\s+/g,' ').trim().split(' ').filter(Boolean); if(!words.length){ stat.textContent='Add some text above to begin.'; window.__MSHARE__.FocusScreen && window.__MSHARE__.FocusScreen.close(); return;}
          chunk=clamp(chunkInp.value,1,5); idx=0; paused=false; pausedAt=0;
          stat.textContent='Running‚Ä¶'; startBtn.disabled=true; pauseBtn.disabled=false; stopBtn.disabled=false; applyStyles(); render();
          try{audioCtx && audioCtx.resume && audioCtx.resume()}catch(e){}
          countInThen(()=>{ t0=performance.now(); clearInterval(tickTimer); tickTimer=setInterval(()=>{ if(paused) return; beep(); idx=Math.min(words.length, idx+chunk); render(); if(idx>=words.length) halt(false); }, intervalMs()) });
        }, {title:'Fluency Pacer', note:'Follow the highlight. Smooth, not fast.'});
      }
      function halt(byUser){ clearInterval(tickTimer); stat.textContent=byUser?'Stopped':'Finished'; startBtn.disabled=false; pauseBtn.disabled=true; stopBtn.disabled=true; if(byUser) window.__MSHARE__.endAndDyslexia()}
      function togglePause(){ if(!tickTimer) return; if(!paused){ paused=true; clearInterval(tickTimer); pauseBtn.textContent='Resume'; stat.textContent='Paused'; pausedAt=performance.now()-t0-pausedAt; } else { paused=false; pauseBtn.textContent='Pause'; stat.textContent='Running‚Ä¶'; clearInterval(tickTimer); tickTimer=setInterval(()=>{ if(paused) return; beep(); idx=Math.min(words.length, idx+chunk); render(); if(idx>=words.length) halt(false); }, intervalMs()) } }
      function refreshTiming(){ applyStyles(); chunk=clamp(chunkInp.value,1,5); if(tickTimer && !paused){ clearInterval(tickTimer); tickTimer=setInterval(()=>{ if(paused) return; beep(); idx=Math.min(words.length, idx+chunk); render(); if(idx>=words.length) halt(false); }, intervalMs()) } }
      const samples={affirm:"I read at a pace that feels kind to my mind. I breathe softly and let each line arrive. My eyes notice patterns and my brain turns effort into ease. Small wins add up every day.",story:"The bus hummed like a warm radiator. I traced each word on the poster by the door‚Äîtwo lines, then a pause. The river outside blinked silver. When I looked back, the sentence felt lighter.",work:"Hi team, quick update: the feature ships on Friday. I‚Äôll share a simple guide and a one minute demo. Thanks for the steady feedback‚Äîsmall steps, clean progress."};
      pSamples.addEventListener('change',()=>{if(pSamples.value==='custom')return; pText.value=samples[pSamples.value]||pText.value});
      pPaste.addEventListener('click',async()=>{try{const t=await navigator.clipboard.readText(); if(t) pText.value=t}catch(e){alert('Clipboard blocked by browser. Paste manually into the box.')}});
      pImport.addEventListener('change',e=>{const f=e.target.files&&e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=()=>{pText.value=String(r.result||'')}; r.readAsText(f)});
      pExport.addEventListener('click',()=>{const blob=new Blob([pText.value||''],{type:'text/plain'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='pacer_text.txt'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),8000)});
      pClear.addEventListener('click',()=>{pText.value=''; out.innerHTML='<span class="pacer-muted">Text cleared. Add some lines and press <strong>Start</strong>.</span>'; stat.textContent='Idle'});
      fullChk.addEventListener('change',()=>{outWrap.classList.toggle('fullscreen',fullChk.checked)});
      startBtn.addEventListener('click',start); stopBtn.addEventListener('click',()=>halt(true)); pauseBtn.addEventListener('click',togglePause);
      [wpm,chunkInp,modeSel,overlaySel].forEach(el=>el.addEventListener('input',refreshTiming));
      [fontRange,lineRange,letRange].forEach(el=>el.addEventListener('input',applyStyles));
      document.addEventListener('keydown',e=>{
        if(!card) return;
        if(e.key===' '){e.preventDefault(); if(tickTimer) togglePause(); else start()}
        if(e.key==='Escape'){e.preventDefault(); if(tickTimer) halt(true)}
        if(e.key==='+'||e.key==='='){wpm.value=Math.min(300,(parseInt(wpm.value||110,10)+10)); refreshTiming()}
        if(e.key==='-'||e.key==='_'){wpm.value=Math.max(40,(parseInt(wpm.value||110,10)-10)); refreshTiming()}
        if(e.key===']'){chunkInp.value=Math.min(5,(parseInt(chunkInp.value||1,10)+1)); refreshTiming()}
        if(e.key==='['){chunkInp.value=Math.max(1,(parseInt(chunkInp.value||1,10)-1)); refreshTiming()}
      });
      applyStyles();
    })();

    // ===== Resources PDF builder (unchanged behaviour)
    (function(){
      const btn=document.getElementById("downloadResourcesPdf"); if(!btn) return;
      const ASSET="assets/dyslexia_adult_resources.pdf";
      const RES=[{"name":"Twinkl ‚Äì adult dyslexia resources","url":"https://www.twinkl.com.sg/search?q=dyslexia+resources+adult&c=244&r=parent&fco=0&n=30&fa=9"},{"name":"British Dyslexia Association ‚Äì Adults","url":"https://www.bdadyslexia.org.uk/advice/adults"},{"name":"International Dyslexia Association","url":"https://dyslexiaida.org/"},{"name":"Yale Center for Dyslexia & Creativity ‚Äì Adults","url":"https://dyslexia.yale.edu/resources/adults/"},{"name":"Understood.org ‚Äì Dyslexia in adults","url":"https://www.understood.org/en/articles/dyslexia-in-adults"},{"name":"National Center on Improving Literacy","url":"https://improvingliteracy.org/"},{"name":"Reading Rockets","url":"https://readingrockets.org/"},{"name":"NIH / NIDCD","url":"https://www.nidcd.nih.gov/health/voice-speech-and-language"},{"name":"Dyslexia Scotland ‚Äì Adults","url":"https://www.dyslexia-scotland.org.uk/adults/"}];
      async function head(path){try{const r=await fetch(path,{method:"HEAD"}); if(r.ok){const a=document.createElement("a"); a.href=path; a.download=path.split("/").pop()||"dyslexia_adult_resources.pdf"; document.body.appendChild(a); a.click(); a.remove(); return true}}catch(e){} return false}
      function b64ToBytes(b64){const bin=atob(b64.replace(/^data:.*;base64,/,"")); const len=bin.length,out=new Uint8Array(len); for(let i=0;i<len;i++) out[i]=bin.charCodeAt(i); return out}
      function parseJpeg(bytes){let i=2; while(i<bytes.length){ if(bytes[i]!==0xFF){i++; continue} const marker=bytes[i+1]; const len=(bytes[i+2]<<8)|bytes[i+3]; if(marker>=0xC0&&marker<=0xC3){return {h:(bytes[i+5]<<8)|bytes[i+6], w:(bytes[i+7]<<8)|bytes[i+8]}} i+=2+len } return {w:1224,h:1584}}
      async function pdfFromCanvas({fromCanvas,links=[]}){const jpeg=fromCanvas.toDataURL("image/jpeg",.92); const img=b64ToBytes(jpeg); const dim=parseJpeg(img); const PW=595,PH=842; const enc=new TextEncoder(); const chunks=[], offs=[]; let off=0;
        const push=b=>{const a=(typeof b==="string")?enc.encode(b):b; offs.push(off); chunks.push(a); off+=a.length}; const obj=(n,body)=>{push(`${n} 0 obj\n`); push(body); push(`\nendobj\n`)};
        const ann=links.map(a=>{const sx=PW/1224,sy=PH/1584; const x1=a.x*sx,y1=PH-(a.y+a.h)*sy,x2=(a.x+a.w)*sx,y2=PH-(a.y)*sy; return {rect:[x1,y1,x2,y2],url:a.url||""}});
        push("%PDF-1.4\n%\xC2\xB5\xC2\xB7\n"); obj(1,`<< /Type /Catalog /Pages 2 0 R >>`); obj(2,`<< /Type /Pages /Count 1 /Kids [3 0 R] >>`);
        const annRefs=ann.map((_,i)=>`${6+i} 0 R`).join(" "); obj(3,`<< /Type /Page /Parent 2 0 R /MediaBox [0 0 ${PW} ${PH}] /Resources << /XObject << /Im0 5 0 R >> /ProcSet [/PDF /ImageC] >> /Contents 4 0 R ${ann.length?('/Annots ['+annRefs+']'):''} >>`);
        const content=`q\n${PW} 0 0 ${PH} 0 0 cm\n/Im0 Do\nQ\n`; const contentBytes=enc.encode(content); obj(4,`<< /Length ${contentBytes.length} >>\nstream\n${content}endstream`);
        obj(5,`<< /Type /XObject /Subtype /Image /Name /Im0 /Width ${dim.w} /Height ${dim.h} /ColorSpace /DeviceRGB /BitsPerComponent 8 /Filter /DCTDecode /Length ${img.length} >>\nstream\n`); push(img); push(`\nendstream\nendobj\n`);
        ann.forEach((a,i)=>{const rect=a.rect.map(v=>v.toFixed(2)).join(' '); obj(6+i,`<< /Type /Annot /Subtype /Link /Border [0 0 0] /Rect [${rect}] /A << /S /URI /URI (${a.url.replace(/[()]/g,'\\$&')}) >> >>`)});
        const xrefStart=off; push("xref\n"); const count=6+ann.length; push(`0 ${count+1}\n`); push("0000000000 65535 f \n"); for(let i=0;i<count;i++){push(String(offs[i]).padStart(10,'0')+" 00000 n \n")} push(`trailer << /Size ${count+1} /Root 1 0 R >>\nstartxref\n${xrefStart}\n%%EOF`);
        return new Blob(chunks.map(a=>a.buffer?a:new Uint8Array(a)),{type:"application/pdf"})
      }
      async function buildCanvas(){const W=1224,H=1584, cnv=Object.assign(document.createElement('canvas'),{width:W,height:H}), ctx=cnv.getContext('2d');
        ctx.fillStyle='#0a1020'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#fff'; ctx.font='bold 48px ui-sans-serif,system-ui,Segoe UI,Roboto'; ctx.fillText('Dyslexia Adult Resources',72,100);
        ctx.font='500 24px ui-sans-serif,system-ui,Segoe UI,Roboto'; ctx.fillStyle='rgba(255,255,255,.85)'; ctx.fillText('Generated by M Share ‚Ä¢ '+new Date().toLocaleDateString(),72,136);
        ctx.font='600 28px ui-sans-serif,system-ui,Segoe UI,Roboto'; let y=190; const links=[];
        RES.forEach((r,idx)=>{ ctx.fillStyle='rgba(255,255,255,.94)'; const bullet=(idx+1)+'. '; ctx.fillText(bullet+r.name,72,y); y+=34; ctx.font='500 24px ui-sans-serif,system-ui,Segoe UI,Roboto';
          const linkX=92, linkY=y-24; const text=r.url; ctx.fillStyle='#bfe6ff'; ctx.fillText(text,linkX,y); const w=ctx.measureText(text).width; links.push({x:linkX,y:linkY,w:Math.max(220,w),h:30,url:r.url});
          ctx.font='600 28px ui-sans-serif,system-ui,Segoe UI,Roboto'; y+=40; });
        return {canvas:cnv,links};
      }
      async function run(){const ok=await head(ASSET); if(ok) return; try{const built=await buildCanvas(); const blob=await pdfFromCanvas({fromCanvas:built.canvas,links:built.links}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='dyslexia_adult_resources.pdf'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),8000)}catch(e){alert('Could not generate the PDF.')}}
      btn.addEventListener('click',run);
    })();

    // ===== M Share App Tools ‚Äî TTS panel and Trainer (contrast & functionality fixed)
    (function(){
      // TTS Panel
      const sel=document.getElementById('ttsSel'), rate=document.getElementById('ttsRate');
      const start=document.getElementById('ttsStart'), stop=document.getElementById('ttsStop');
      const txt=document.getElementById('ttsText'), out=document.getElementById('ttsOut');
      function applyPref(){ window.__MSHARE__.TTS_WANT=sel.value; try{window.__MSHARE__.TTS.setPref(sel.value)}catch(e){} }
      sel.addEventListener('change',applyPref); applyPref();
      start.addEventListener('click',()=>window.__MSHARE__.beginTraining('tts', document.getElementById('ttsPanel'), ()=>{
        start.disabled=true; stop.disabled=false; out.textContent='Reading‚Ä¶';
        const words=(txt.value||'').split(/\s+/).filter(Boolean); let i=0;
        const tick=()=>{ if(i>=words.length){ stop.click(); return } window.__MSHARE__.TTS.speak(words[i], parseFloat(rate.value||'1.0')||1.0); // speak word
          // simple highlight in place
          const before=words.slice(0,i).join(' '), curr=words[i], after=words.slice(i+1).join(' ');
          txt.value = [before, curr, after].filter(Boolean).join(' ');
          i++; setTimeout(tick, 600);
        }; tick();
      }, {title:'TTS with Tracking', note:'Symbols are ignored; clear, natural speech.'}));
      stop.addEventListener('click',()=>{ try{speechSynthesis.cancel()}catch(e){} start.disabled=false; stop.disabled=true; out.textContent='Stopped'; window.__MSHARE__.endAndDyslexia() });

      // Trainer (keep highlight logic in sync)
      const tText=document.getElementById('trainerText'), tPace=document.getElementById('trainerPace');
      const tStart=document.getElementById('startTrainer'), tStop=document.getElementById('stopTrainer'), disp=document.getElementById('trainerDisplay');
      function esc(s){return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
      function interval(){const wpm=Math.max(60,Math.min(400,parseInt(tPace.value||120,10))); return Math.round(60000/wpm)}
      let tTimer=null, tWords=[], tIdx=0;
      function render(){ const prev=tWords.slice(0,tIdx).join(' '), curr=tWords[tIdx]||'', rest=tWords.slice(tIdx+1).join(' ');
        disp.innerHTML='<span class="pacer-prev">'+esc(prev)+'</span> <span class="pacer-current">'+esc(curr)+'</span> <span class="pacer-muted">'+esc(rest)+'</span>'; }
      function begin(){ tWords=(tText.value||'').replace(/\s+/g,' ').trim().split(' ').filter(Boolean); if(!tWords.length){ disp.innerHTML='<p class="muted">Add some text above to start.</p>'; return }
        tIdx=0; tStart.disabled=true; tStop.disabled=false; render();
        clearInterval(tTimer); tTimer=setInterval(()=>{ tIdx++; if(tIdx>=tWords.length){ end(false); return } render(); }, interval());
      }
      function end(byUser){ clearInterval(tTimer); tStart.disabled=false; tStop.disabled=true; if(byUser) window.__MSHARE__.endAndDyslexia() }
      tStart.addEventListener('click',()=>window.__MSHARE__.beginTraining('trainer', document.getElementById('sec-mshare-app')||disp, begin, {title:'Paced Reading', note:'Eyes follow the highlight. Keep it smooth.'}));
      tStop.addEventListener('click',()=>end(true));
    })();

    // ===== Mobile/medium navigation patch (unchanged behaviour; braces validated)
    (function(){
      var MQ=window.matchMedia?window.matchMedia("(max-width: 1024px)"):{matches:true,addEventListener:function(){}};
      function findNav(){return document.getElementById('mainNav')||document.querySelector('nav.main-nav')||document.querySelector('header nav')||document.querySelector('nav')}
      (function(){
        var nav=findNav(); if(!nav) return;
        document.querySelectorAll('a[data-href]').forEach(function(a){ if(!a.getAttribute('href')) a.setAttribute('href', a.getAttribute('data-href')) });
        var toggle=document.getElementById('navToggle')||document.querySelector('.nav-toggle, .hamburger, [aria-controls="mainNav"]');
        function openNav(){ if(!MQ.matches||!nav||!toggle) return; toggle.setAttribute('aria-expanded','true'); nav.removeAttribute('hidden'); var cs=getComputedStyle(nav); if(cs.display==='none') nav.style.display='block'; document.body.classList.add('nav-open') }
        function closeNav(){ if(!nav||!toggle) return; toggle.setAttribute('aria-expanded','false'); if(MQ.matches){nav.setAttribute('hidden',''); nav.style.display='none'} document.body.classList.remove('nav-open') }
        function isOpen(){return toggle && toggle.getAttribute('aria-expanded')==='true'}
        if(toggle){
          toggle.setAttribute('aria-controls', nav.id||'mainNav');
          if(!toggle.hasAttribute('aria-expanded')) toggle.setAttribute('aria-expanded','false');
          toggle.addEventListener('click',function(e){ if(!MQ.matches) return; e.preventDefault(); isOpen()?closeNav():openNav() },{passive:false});
          document.addEventListener('click',function(e){ if(!MQ.matches||!isOpen()) return; if(e.target.closest('#mainNav, #navToggle, .nav-toggle, .hamburger')) return; closeNav() },{passive:true});
          document.addEventListener('keydown',function(e){ if(MQ.matches && e.key==='Escape' && isOpen()) closeNav() },{passive:true});
        }
        function closeOthers(except){
          if(!MQ.matches) return;
          nav.querySelectorAll('.menu-group.open').forEach(function(g){
            if(g===except) return;
            var m=g.querySelector('.submenu, [role="menu"], :scope > ul'); if(m) m.setAttribute('hidden','');
            g.classList.remove('open');
            var t=g.querySelector('.menu-toggle, .chevron, [data-chevron], :scope > a, :scope > button'); if(t) t.setAttribute('aria-expanded','false');
          });
        }
        Array.prototype.slice.call(nav.querySelectorAll('.menu-group')).forEach(function(g){
          var menu=g.querySelector('.submenu, [role="menu"], :scope > ul'); if(!menu) return;
          var btn=g.querySelector('.menu-toggle, .chevron, [data-chevron]')||g.querySelector(':scope > a')||g.firstElementChild;
          function init(){ if(!MQ.matches){ menu.removeAttribute('hidden'); g.classList.remove('open'); if(btn) btn.setAttribute('aria-expanded','false'); return }
            menu.setAttribute('hidden',''); g.classList.remove('open'); if(btn){ btn.setAttribute('tabindex','0'); btn.setAttribute('aria-haspopup','menu'); btn.setAttribute('aria-expanded','false') } }
          function open(){ closeOthers(g); menu.removeAttribute('hidden'); g.classList.add('open'); if(btn) btn.setAttribute('aria-expanded','true') }
          function close(){ menu.setAttribute('hidden',''); g.classList.remove('open'); if(btn) btn.setAttribute('aria-expanded','false') }
          function toggle(e){ if(e) e.preventDefault(); (g.classList.contains('open')?close:open)() }
          init(); if(MQ.addEventListener) MQ.addEventListener('change',init); else if(MQ.addListener) MQ.addListener(init);
          if(btn){
            btn.addEventListener('click',function(e){ if(!MQ.matches) return; toggle(e) },{passive:false});
            btn.addEventListener('keydown',function(e){ if(!MQ.matches) return; if(e.key==='Enter'||e.key===' '){e.preventDefault();toggle(e)} if(e.key==='Escape'){e.preventDefault();close();btn.focus()} },{passive:false});
          }
          if(window.matchMedia && window.matchMedia('(pointer:fine)').matches){
            g.addEventListener('mouseenter',function(){ if(!MQ.matches) open() },{passive:true});
            g.addEventListener('mouseleave',function(){ if(!MQ.matches) close() },{passive:true});
            g.addEventListener('focusin',function(){ if(!MQ.matches) open() },{passive:true});
            g.addEventListener('focusout',function(ev){ if(MQ.matches) return; if(!g.contains(ev.relatedTarget)) close() },{passive:true});
          }
        });
        document.addEventListener('click',function(e){ if(!MQ.matches) return; var hit=e.target.closest('.menu-group'); if(!hit) closeOthers(null) },{passive:true});
      })();
    })();

    // ===== Coach add/open wiring (unchanged logic; braces validated) =====
    (function(){
      var COACH_KEY='mshare_coach_modules_v1';
      function loadModules(){ try{return JSON.parse(localStorage.getItem(COACH_KEY)||'{}')||{}}catch(e){return {}} }
      function saveModules(m){ try{localStorage.setItem(COACH_KEY, JSON.stringify(m))}catch(e){} }
      var add=document.getElementById('btnAddCoachDys');
      var open=document.getElementById('btnOpenCoachDys');
      add && add.addEventListener('click',function(){
        var mods=loadModules();
        if(!mods.autism){ alert('Add the Autism coach first on the Autism page.'); return }
        mods.dyslexia={ id:'dyslexia', name:'Dyslexia Coach', flows:mods.autism.flows, addedAt:Date.now() };
        saveModules(mods);
        alert('Dyslexia Coach added (using current flows). You can refine this module later.');
      });
      open && open.addEventListener('click',function(){ location.href='autism.html#open-coach' });
    })();
  </script>

  <!-- Optional site scripts -->
  <script src="assets/js/ux-fixes.js"></script>
  <script src="assets/js/site-core.js"></script>

  <!-- Footer VA toggle (unchanged) -->
  <div id="mshare-voice-toggle" aria-live="polite" aria-label="Show Voice Assistant"><button type="button" title="Show Voice">Voice</button></div>
  <script src="assets/js/va-controls.js" defer></script>
  <script src="assets/js/home-goal-tiles.js" defer></script>
</body>
</html>
